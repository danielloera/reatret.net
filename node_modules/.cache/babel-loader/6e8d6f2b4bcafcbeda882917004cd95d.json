{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Util_1 = require(\"../Util\");\n\nvar Factory_1 = require(\"../Factory\");\n\nvar Node_1 = require(\"../Node\");\n\nvar Shape_1 = require(\"../Shape\");\n\nvar Rect_1 = require(\"./Rect\");\n\nvar Group_1 = require(\"../Group\");\n\nvar Global_1 = require(\"../Global\");\n\nvar Validators_1 = require(\"../Validators\");\n\nvar Global_2 = require(\"../Global\");\n\nvar ATTR_CHANGE_LIST = ['resizeEnabledChange', 'rotateAnchorOffsetChange', 'rotateEnabledChange', 'enabledAnchorsChange', 'anchorSizeChange', 'borderEnabledChange', 'borderStrokeChange', 'borderStrokeWidthChange', 'borderDashChange', 'anchorStrokeChange', 'anchorStrokeWidthChange', 'anchorFillChange', 'anchorCornerRadiusChange', 'ignoreStrokeChange'].join(' ');\nvar NODE_RECT = 'nodeRect';\nvar TRANSFORM_CHANGE_STR = ['widthChange.tr', 'heightChange.tr', 'scaleXChange.tr', 'scaleYChange.tr', 'skewXChange.tr', 'skewYChange.tr', 'rotationChange.tr', 'offsetXChange.tr', 'offsetYChange.tr', 'transformsEnabledChange.tr', 'strokeWidthChange.tr'].join(' ');\nvar ANGLES = {\n  'top-left': -45,\n  'top-center': 0,\n  'top-right': 45,\n  'middle-right': -90,\n  'middle-left': 90,\n  'bottom-left': -135,\n  'bottom-center': 180,\n  'bottom-right': 135\n};\n\nfunction getCursor(anchorName, rad, isMirrored) {\n  if (anchorName === 'rotater') {\n    return 'crosshair';\n  }\n\n  rad += Util_1.Util._degToRad(ANGLES[anchorName] || 0);\n\n  if (isMirrored) {\n    rad *= -1;\n  }\n\n  var angle = (Util_1.Util._radToDeg(rad) % 360 + 360) % 360;\n\n  if (Util_1.Util._inRange(angle, 315 + 22.5, 360) || Util_1.Util._inRange(angle, 0, 22.5)) {\n    return 'ns-resize';\n  } else if (Util_1.Util._inRange(angle, 45 - 22.5, 45 + 22.5)) {\n    return 'nesw-resize';\n  } else if (Util_1.Util._inRange(angle, 90 - 22.5, 90 + 22.5)) {\n    return 'ew-resize';\n  } else if (Util_1.Util._inRange(angle, 135 - 22.5, 135 + 22.5)) {\n    return 'nwse-resize';\n  } else if (Util_1.Util._inRange(angle, 180 - 22.5, 180 + 22.5)) {\n    return 'ns-resize';\n  } else if (Util_1.Util._inRange(angle, 225 - 22.5, 225 + 22.5)) {\n    return 'nesw-resize';\n  } else if (Util_1.Util._inRange(angle, 270 - 22.5, 270 + 22.5)) {\n    return 'ew-resize';\n  } else if (Util_1.Util._inRange(angle, 315 - 22.5, 315 + 22.5)) {\n    return 'nwse-resize';\n  } else {\n    Util_1.Util.error('Transformer has unknown angle for cursor detection: ' + angle);\n    return 'pointer';\n  }\n}\n\nvar ANCHORS_NAMES = ['top-left', 'top-center', 'top-right', 'middle-right', 'middle-left', 'bottom-left', 'bottom-center', 'bottom-right'];\nvar MAX_SAFE_INTEGER = 100000000;\n\nvar Transformer = function (_super) {\n  __extends(Transformer, _super);\n\n  function Transformer(config) {\n    var _this = _super.call(this, config) || this;\n\n    _this._transforming = false;\n\n    _this._createElements();\n\n    _this._handleMouseMove = _this._handleMouseMove.bind(_this);\n    _this._handleMouseUp = _this._handleMouseUp.bind(_this);\n    _this.update = _this.update.bind(_this);\n\n    _this.on(ATTR_CHANGE_LIST, _this.update);\n\n    if (_this.getNode()) {\n      _this.update();\n    }\n\n    return _this;\n  }\n\n  Transformer.prototype.attachTo = function (node) {\n    this.setNode(node);\n    return this;\n  };\n\n  Transformer.prototype.setNode = function (node) {\n    var _this = this;\n\n    if (this._node) {\n      this.detach();\n    }\n\n    this._node = node;\n\n    this._resetTransformCache();\n\n    var additionalEvents = node._attrsAffectingSize.map(function (prop) {\n      return prop + 'Change.tr';\n    }).join(' ');\n\n    var onChange = function onChange() {\n      _this._resetTransformCache();\n\n      if (!_this._transforming) {\n        _this.update();\n      }\n    };\n\n    node.on(additionalEvents, onChange);\n    node.on(TRANSFORM_CHANGE_STR, onChange);\n    node.on('xChange.tr yChange.tr', function () {\n      return _this._resetTransformCache();\n    });\n    var elementsCreated = !!this.findOne('.top-left');\n\n    if (elementsCreated) {\n      this.update();\n    }\n\n    return this;\n  };\n\n  Transformer.prototype.getNode = function () {\n    return this._node;\n  };\n\n  Transformer.prototype.detach = function () {\n    if (this.getNode()) {\n      this.getNode().off('.tr');\n      this._node = undefined;\n    }\n\n    this._resetTransformCache();\n  };\n\n  Transformer.prototype._resetTransformCache = function () {\n    this._clearCache(NODE_RECT);\n\n    this._clearCache('transform');\n\n    this._clearSelfAndDescendantCache('absoluteTransform');\n  };\n\n  Transformer.prototype._getNodeRect = function () {\n    return this._getCache(NODE_RECT, this.__getNodeRect);\n  };\n\n  Transformer.prototype.__getNodeRect = function () {\n    var node = this.getNode();\n\n    if (!node) {\n      return {\n        x: -MAX_SAFE_INTEGER,\n        y: -MAX_SAFE_INTEGER,\n        width: 0,\n        height: 0,\n        rotation: 0\n      };\n    }\n\n    var rect = node.getClientRect({\n      skipTransform: true,\n      skipShadow: true,\n      skipStroke: this.ignoreStroke()\n    });\n    var rotation = Global_1.Konva.getAngle(node.rotation());\n    var dx = rect.x * node.scaleX() - node.offsetX() * node.scaleX();\n    var dy = rect.y * node.scaleY() - node.offsetY() * node.scaleY();\n    return {\n      x: node.x() + dx * Math.cos(rotation) + dy * Math.sin(-rotation),\n      y: node.y() + dy * Math.cos(rotation) + dx * Math.sin(rotation),\n      width: rect.width * node.scaleX(),\n      height: rect.height * node.scaleY(),\n      rotation: node.rotation()\n    };\n  };\n\n  Transformer.prototype.getX = function () {\n    return this._getNodeRect().x;\n  };\n\n  Transformer.prototype.getY = function () {\n    return this._getNodeRect().y;\n  };\n\n  Transformer.prototype.getRotation = function () {\n    return this._getNodeRect().rotation;\n  };\n\n  Transformer.prototype.getWidth = function () {\n    return this._getNodeRect().width;\n  };\n\n  Transformer.prototype.getHeight = function () {\n    return this._getNodeRect().height;\n  };\n\n  Transformer.prototype._createElements = function () {\n    this._createBack();\n\n    ANCHORS_NAMES.forEach(function (name) {\n      this._createAnchor(name);\n    }.bind(this));\n\n    this._createAnchor('rotater');\n  };\n\n  Transformer.prototype._createAnchor = function (name) {\n    var anchor = new Rect_1.Rect({\n      stroke: 'rgb(0, 161, 255)',\n      fill: 'white',\n      strokeWidth: 1,\n      name: name + ' _anchor',\n      dragDistance: 0,\n      draggable: true\n    });\n    var self = this;\n    anchor.on('mousedown touchstart', function (e) {\n      self._handleMouseDown(e);\n    });\n    anchor.on('dragstart', function (e) {\n      e.cancelBubble = true;\n    });\n    anchor.on('dragmove', function (e) {\n      e.cancelBubble = true;\n    });\n    anchor.on('dragend', function (e) {\n      e.cancelBubble = true;\n    });\n    anchor.on('mouseenter', function () {\n      var tr = this.getParent();\n      var rad = Global_1.Konva.getAngle(tr.rotation());\n      var scale = tr.getNode().getAbsoluteScale();\n      var isMirrored = scale.y * scale.x < 0;\n      var cursor = getCursor(name, rad, isMirrored);\n      anchor.getStage().content.style.cursor = cursor;\n      tr._cursorChange = true;\n    });\n    anchor.on('mouseout', function () {\n      if (!anchor.getStage() || !this.getParent()) {\n        return;\n      }\n\n      anchor.getStage().content.style.cursor = '';\n      this.getParent()._cursorChange = false;\n    });\n    this.add(anchor);\n  };\n\n  Transformer.prototype._createBack = function () {\n    var back = new Shape_1.Shape({\n      name: 'back',\n      width: 0,\n      height: 0,\n      listening: false,\n      sceneFunc: function sceneFunc(ctx) {\n        var tr = this.getParent();\n        var padding = tr.padding();\n        ctx.beginPath();\n        ctx.rect(-padding, -padding, this.width() + padding * 2, this.height() + padding * 2);\n        ctx.moveTo(this.width() / 2, -padding);\n\n        if (tr.rotateEnabled()) {\n          ctx.lineTo(this.width() / 2, -tr.rotateAnchorOffset() * Util_1.Util._sign(this.height()));\n        }\n\n        ctx.fillStrokeShape(this);\n      }\n    });\n    this.add(back);\n  };\n\n  Transformer.prototype._handleMouseDown = function (e) {\n    this.movingResizer = e.target.name().split(' ')[0];\n\n    var attrs = this._getNodeRect();\n\n    var width = attrs.width;\n    var height = attrs.height;\n    var hypotenuse = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2));\n    this.sin = height / hypotenuse;\n    this.cos = width / hypotenuse;\n    window.addEventListener('mousemove', this._handleMouseMove);\n    window.addEventListener('touchmove', this._handleMouseMove);\n    window.addEventListener('mouseup', this._handleMouseUp, true);\n    window.addEventListener('touchend', this._handleMouseUp, true);\n    this._transforming = true;\n\n    this._fire('transformstart', {\n      evt: e\n    });\n\n    this.getNode()._fire('transformstart', {\n      evt: e\n    });\n  };\n\n  Transformer.prototype._handleMouseMove = function (e) {\n    var x, y, newHypotenuse;\n    var resizerNode = this.findOne('.' + this.movingResizer);\n    var stage = resizerNode.getStage();\n    var box = stage.getContent().getBoundingClientRect();\n    var zeroPoint = {\n      x: box.left,\n      y: box.top\n    };\n    var pointerPos = {\n      left: e.clientX !== undefined ? e.clientX : e.touches[0].clientX,\n      top: e.clientX !== undefined ? e.clientY : e.touches[0].clientY\n    };\n    var newAbsPos = {\n      x: pointerPos.left - zeroPoint.x,\n      y: pointerPos.top - zeroPoint.y\n    };\n    resizerNode.setAbsolutePosition(newAbsPos);\n    var keepProportion = this.keepRatio() || e.shiftKey;\n\n    if (this.movingResizer === 'top-left') {\n      if (keepProportion) {\n        newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x() - resizerNode.x(), 2) + Math.pow(this.findOne('.bottom-right').y() - resizerNode.y(), 2));\n        x = newHypotenuse * this.cos;\n        y = newHypotenuse * this.sin;\n        this.findOne('.top-left').x(this.findOne('.bottom-right').x() - x);\n        this.findOne('.top-left').y(this.findOne('.bottom-right').y() - y);\n      }\n    } else if (this.movingResizer === 'top-center') {\n      this.findOne('.top-left').y(resizerNode.y());\n    } else if (this.movingResizer === 'top-right') {\n      if (keepProportion) {\n        newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-left').x() - resizerNode.x(), 2) + Math.pow(this.findOne('.bottom-left').y() - resizerNode.y(), 2));\n        x = newHypotenuse * this.cos;\n        y = newHypotenuse * this.sin;\n        this.findOne('.top-right').x(x);\n        this.findOne('.top-right').y(this.findOne('.bottom-left').y() - y);\n      }\n\n      var pos = resizerNode.position();\n      this.findOne('.top-left').y(pos.y);\n      this.findOne('.bottom-right').x(pos.x);\n    } else if (this.movingResizer === 'middle-left') {\n      this.findOne('.top-left').x(resizerNode.x());\n    } else if (this.movingResizer === 'middle-right') {\n      this.findOne('.bottom-right').x(resizerNode.x());\n    } else if (this.movingResizer === 'bottom-left') {\n      if (keepProportion) {\n        newHypotenuse = Math.sqrt(Math.pow(this.findOne('.top-right').x() - resizerNode.x(), 2) + Math.pow(this.findOne('.top-right').y() - resizerNode.y(), 2));\n        x = newHypotenuse * this.cos;\n        y = newHypotenuse * this.sin;\n        this.findOne('.bottom-left').x(this.findOne('.top-right').x() - x);\n        this.findOne('.bottom-left').y(y);\n      }\n\n      pos = resizerNode.position();\n      this.findOne('.top-left').x(pos.x);\n      this.findOne('.bottom-right').y(pos.y);\n    } else if (this.movingResizer === 'bottom-center') {\n      this.findOne('.bottom-right').y(resizerNode.y());\n    } else if (this.movingResizer === 'bottom-right') {\n      if (keepProportion) {\n        newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x(), 2) + Math.pow(this.findOne('.bottom-right').y(), 2));\n        x = newHypotenuse * this.cos;\n        y = newHypotenuse * this.sin;\n        this.findOne('.bottom-right').x(x);\n        this.findOne('.bottom-right').y(y);\n      }\n    } else if (this.movingResizer === 'rotater') {\n      var padding = this.padding();\n\n      var attrs = this._getNodeRect();\n\n      x = resizerNode.x() - attrs.width / 2;\n      y = -resizerNode.y() + attrs.height / 2;\n      var dAlpha = Math.atan2(-y, x) + Math.PI / 2;\n\n      if (attrs.height < 0) {\n        dAlpha -= Math.PI;\n      }\n\n      var rot = Global_1.Konva.getAngle(this.rotation());\n\n      var newRotation = Util_1.Util._radToDeg(rot) + Util_1.Util._radToDeg(dAlpha);\n\n      var alpha = Global_1.Konva.getAngle(this.getNode().rotation());\n\n      var newAlpha = Util_1.Util._degToRad(newRotation);\n\n      var snaps = this.rotationSnaps();\n      var offset = 0.1;\n\n      for (var i = 0; i < snaps.length; i++) {\n        var angle = Global_1.Konva.getAngle(snaps[i]);\n        var dif = Math.abs(angle - Util_1.Util._degToRad(newRotation)) % (Math.PI * 2);\n\n        if (dif < offset) {\n          newRotation = Util_1.Util._radToDeg(angle);\n          newAlpha = Util_1.Util._degToRad(newRotation);\n        }\n      }\n\n      var dx = padding;\n      var dy = padding;\n\n      this._fitNodeInto({\n        rotation: Global_1.Konva.angleDeg ? newRotation : Util_1.Util._degToRad(newRotation),\n        x: attrs.x + (attrs.width / 2 + padding) * (Math.cos(alpha) - Math.cos(newAlpha)) + (attrs.height / 2 + padding) * (Math.sin(-alpha) - Math.sin(-newAlpha)) - (dx * Math.cos(rot) + dy * Math.sin(-rot)),\n        y: attrs.y + (attrs.height / 2 + padding) * (Math.cos(alpha) - Math.cos(newAlpha)) + (attrs.width / 2 + padding) * (Math.sin(alpha) - Math.sin(newAlpha)) - (dy * Math.cos(rot) + dx * Math.sin(rot)),\n        width: attrs.width + padding * 2,\n        height: attrs.height + padding * 2\n      }, e);\n    } else {\n      console.error(new Error('Wrong position argument of selection resizer: ' + this.movingResizer));\n    }\n\n    if (this.movingResizer === 'rotater') {\n      return;\n    }\n\n    var absPos = this.findOne('.top-left').getAbsolutePosition(this.getParent());\n    var centeredScaling = this.centeredScaling() || e.altKey;\n\n    if (centeredScaling) {\n      var topLeft = this.findOne('.top-left');\n      var bottomRight = this.findOne('.bottom-right');\n      var topOffsetX = topLeft.x();\n      var topOffsetY = topLeft.y();\n      var bottomOffsetX = this.getWidth() - bottomRight.x();\n      var bottomOffsetY = this.getHeight() - bottomRight.y();\n      bottomRight.move({\n        x: -topOffsetX,\n        y: -topOffsetY\n      });\n      topLeft.move({\n        x: bottomOffsetX,\n        y: bottomOffsetY\n      });\n      absPos = topLeft.getAbsolutePosition(this.getParent());\n    }\n\n    x = absPos.x;\n    y = absPos.y;\n    var width = this.findOne('.bottom-right').x() - this.findOne('.top-left').x();\n    var height = this.findOne('.bottom-right').y() - this.findOne('.top-left').y();\n\n    this._fitNodeInto({\n      x: x + this.offsetX(),\n      y: y + this.offsetY(),\n      width: width,\n      height: height\n    }, e);\n  };\n\n  Transformer.prototype._handleMouseUp = function (e) {\n    this._removeEvents(e);\n  };\n\n  Transformer.prototype._removeEvents = function (e) {\n    if (this._transforming) {\n      this._transforming = false;\n      window.removeEventListener('mousemove', this._handleMouseMove);\n      window.removeEventListener('touchmove', this._handleMouseMove);\n      window.removeEventListener('mouseup', this._handleMouseUp, true);\n      window.removeEventListener('touchend', this._handleMouseUp, true);\n\n      this._fire('transformend', {\n        evt: e\n      });\n\n      var node = this.getNode();\n\n      if (node) {\n        node.fire('transformend', {\n          evt: e\n        });\n      }\n    }\n  };\n\n  Transformer.prototype._fitNodeInto = function (newAttrs, evt) {\n    var boundBoxFunc = this.boundBoxFunc();\n\n    if (boundBoxFunc) {\n      var oldAttrs = this._getNodeRect();\n\n      newAttrs = boundBoxFunc.call(this, oldAttrs, newAttrs);\n    }\n\n    var node = this.getNode();\n\n    if (newAttrs.rotation !== undefined) {\n      this.getNode().rotation(newAttrs.rotation);\n    }\n\n    var pure = node.getClientRect({\n      skipTransform: true,\n      skipShadow: true,\n      skipStroke: this.ignoreStroke()\n    });\n    var padding = this.padding();\n    var scaleX = (newAttrs.width - padding * 2) / pure.width;\n    var scaleY = (newAttrs.height - padding * 2) / pure.height;\n    var rotation = Global_1.Konva.getAngle(node.rotation());\n    var dx = pure.x * scaleX - padding - node.offsetX() * scaleX;\n    var dy = pure.y * scaleY - padding - node.offsetY() * scaleY;\n    this.getNode().setAttrs({\n      scaleX: scaleX,\n      scaleY: scaleY,\n      x: newAttrs.x - (dx * Math.cos(rotation) + dy * Math.sin(-rotation)),\n      y: newAttrs.y - (dy * Math.cos(rotation) + dx * Math.sin(rotation))\n    });\n\n    this._fire('transform', {\n      evt: evt\n    });\n\n    this.getNode()._fire('transform', {\n      evt: evt\n    });\n\n    this.update();\n    this.getLayer().batchDraw();\n  };\n\n  Transformer.prototype.forceUpdate = function () {\n    this._resetTransformCache();\n\n    this.update();\n  };\n\n  Transformer.prototype.update = function () {\n    var _this = this;\n\n    var attrs = this._getNodeRect();\n\n    var node = this.getNode();\n    var scale = {\n      x: 1,\n      y: 1\n    };\n\n    if (node && node.getParent()) {\n      scale = node.getParent().getAbsoluteScale();\n    }\n\n    var invertedScale = {\n      x: 1 / scale.x,\n      y: 1 / scale.y\n    };\n    var width = attrs.width;\n    var height = attrs.height;\n    var enabledAnchors = this.enabledAnchors();\n    var resizeEnabled = this.resizeEnabled();\n    var padding = this.padding();\n    var anchorSize = this.anchorSize();\n    this.find('._anchor').each(function (node) {\n      return node.setAttrs({\n        width: anchorSize,\n        height: anchorSize,\n        offsetX: anchorSize / 2,\n        offsetY: anchorSize / 2,\n        stroke: _this.anchorStroke(),\n        strokeWidth: _this.anchorStrokeWidth(),\n        fill: _this.anchorFill(),\n        cornerRadius: _this.anchorCornerRadius()\n      });\n    });\n    this.findOne('.top-left').setAttrs({\n      x: -padding,\n      y: -padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('top-left') >= 0\n    });\n    this.findOne('.top-center').setAttrs({\n      x: width / 2,\n      y: -padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('top-center') >= 0\n    });\n    this.findOne('.top-right').setAttrs({\n      x: width + padding,\n      y: -padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('top-right') >= 0\n    });\n    this.findOne('.middle-left').setAttrs({\n      x: -padding,\n      y: height / 2,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('middle-left') >= 0\n    });\n    this.findOne('.middle-right').setAttrs({\n      x: width + padding,\n      y: height / 2,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('middle-right') >= 0\n    });\n    this.findOne('.bottom-left').setAttrs({\n      x: -padding,\n      y: height + padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('bottom-left') >= 0\n    });\n    this.findOne('.bottom-center').setAttrs({\n      x: width / 2,\n      y: height + padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('bottom-center') >= 0\n    });\n    this.findOne('.bottom-right').setAttrs({\n      x: width + padding,\n      y: height + padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('bottom-right') >= 0\n    });\n    var scaledRotateAnchorOffset = -this.rotateAnchorOffset() * Math.abs(invertedScale.y);\n    this.findOne('.rotater').setAttrs({\n      x: width / 2,\n      y: scaledRotateAnchorOffset * Util_1.Util._sign(height),\n      scale: invertedScale,\n      visible: this.rotateEnabled()\n    });\n    this.findOne('.back').setAttrs({\n      width: width * scale.x,\n      height: height * scale.y,\n      scale: invertedScale,\n      visible: this.borderEnabled(),\n      stroke: this.borderStroke(),\n      strokeWidth: this.borderStrokeWidth(),\n      dash: this.borderDash()\n    });\n  };\n\n  Transformer.prototype.isTransforming = function () {\n    return this._transforming;\n  };\n\n  Transformer.prototype.stopTransform = function () {\n    if (this._transforming) {\n      this._removeEvents();\n\n      var resizerNode = this.findOne('.' + this.movingResizer);\n\n      if (resizerNode) {\n        resizerNode.stopDrag();\n      }\n    }\n  };\n\n  Transformer.prototype.destroy = function () {\n    if (this.getStage() && this._cursorChange) {\n      this.getStage().content.style.cursor = '';\n    }\n\n    Group_1.Group.prototype.destroy.call(this);\n    this.detach();\n\n    this._removeEvents();\n\n    return this;\n  };\n\n  Transformer.prototype.toObject = function () {\n    return Node_1.Node.prototype.toObject.call(this);\n  };\n\n  return Transformer;\n}(Group_1.Group);\n\nexports.Transformer = Transformer;\n\nfunction validateAnchors(val) {\n  if (!(val instanceof Array)) {\n    Util_1.Util.warn('enabledAnchors value should be an array');\n  }\n\n  if (val instanceof Array) {\n    val.forEach(function (name) {\n      if (ANCHORS_NAMES.indexOf(name) === -1) {\n        Util_1.Util.warn('Unknown anchor name: ' + name + '. Available names are: ' + ANCHORS_NAMES.join(', '));\n      }\n    });\n  }\n\n  return val || [];\n}\n\nTransformer.prototype.className = 'Transformer';\n\nGlobal_2._registerNode(Transformer);\n\nFactory_1.Factory.addGetterSetter(Transformer, 'enabledAnchors', ANCHORS_NAMES, validateAnchors);\nFactory_1.Factory.addGetterSetter(Transformer, 'resizeEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorSize', 10, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotationSnaps', []);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateAnchorOffset', 50, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorFill', 'white');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorCornerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderDash');\nFactory_1.Factory.addGetterSetter(Transformer, 'keepRatio', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'centeredScaling', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'ignoreStroke', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'padding', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'node');\nFactory_1.Factory.addGetterSetter(Transformer, 'boundBoxFunc');\nFactory_1.Factory.backCompat(Transformer, {\n  lineEnabled: 'borderEnabled',\n  rotateHandlerOffset: 'rotateAnchorOffset',\n  enabledHandlers: 'enabledAnchors'\n});\nUtil_1.Collection.mapMethods(Transformer);","map":{"version":3,"sources":["/home/daniel/reatret.net/react-app/node_modules/konva/lib/shapes/Transformer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","exports","value","Util_1","require","Factory_1","Node_1","Shape_1","Rect_1","Group_1","Global_1","Validators_1","Global_2","ATTR_CHANGE_LIST","join","NODE_RECT","TRANSFORM_CHANGE_STR","ANGLES","getCursor","anchorName","rad","isMirrored","Util","_degToRad","angle","_radToDeg","_inRange","error","ANCHORS_NAMES","MAX_SAFE_INTEGER","Transformer","_super","config","_this","call","_transforming","_createElements","_handleMouseMove","bind","_handleMouseUp","update","on","getNode","attachTo","node","setNode","_node","detach","_resetTransformCache","additionalEvents","_attrsAffectingSize","map","prop","onChange","elementsCreated","findOne","off","undefined","_clearCache","_clearSelfAndDescendantCache","_getNodeRect","_getCache","__getNodeRect","x","y","width","height","rotation","rect","getClientRect","skipTransform","skipShadow","skipStroke","ignoreStroke","Konva","getAngle","dx","scaleX","offsetX","dy","scaleY","offsetY","Math","cos","sin","getX","getY","getRotation","getWidth","getHeight","_createBack","forEach","name","_createAnchor","anchor","Rect","stroke","fill","strokeWidth","dragDistance","draggable","self","e","_handleMouseDown","cancelBubble","tr","getParent","scale","getAbsoluteScale","cursor","getStage","content","style","_cursorChange","add","back","Shape","listening","sceneFunc","ctx","padding","beginPath","moveTo","rotateEnabled","lineTo","rotateAnchorOffset","_sign","fillStrokeShape","movingResizer","target","split","attrs","hypotenuse","sqrt","pow","window","addEventListener","_fire","evt","newHypotenuse","resizerNode","stage","box","getContent","getBoundingClientRect","zeroPoint","left","top","pointerPos","clientX","touches","clientY","newAbsPos","setAbsolutePosition","keepProportion","keepRatio","shiftKey","pos","position","dAlpha","atan2","PI","rot","newRotation","alpha","newAlpha","snaps","rotationSnaps","offset","i","length","dif","abs","_fitNodeInto","angleDeg","console","Error","absPos","getAbsolutePosition","centeredScaling","altKey","topLeft","bottomRight","topOffsetX","topOffsetY","bottomOffsetX","bottomOffsetY","move","_removeEvents","removeEventListener","fire","newAttrs","boundBoxFunc","oldAttrs","pure","setAttrs","getLayer","batchDraw","forceUpdate","invertedScale","enabledAnchors","resizeEnabled","anchorSize","find","each","anchorStroke","anchorStrokeWidth","anchorFill","cornerRadius","anchorCornerRadius","visible","indexOf","scaledRotateAnchorOffset","borderEnabled","borderStroke","borderStrokeWidth","dash","borderDash","isTransforming","stopTransform","stopDrag","destroy","Group","toObject","Node","validateAnchors","val","warn","className","_registerNode","Factory","addGetterSetter","getNumberValidator","backCompat","lineEnabled","rotateHandlerOffset","enabledHandlers","Collection","mapMethods"],"mappings":"AAAA;;AACA,IAAIA,SAAS,GAAI,QAAQ,KAAKA,SAAd,IAA6B,YAAY;AACrD,MAAIC,cAAa,GAAG,uBAAUC,CAAV,EAAaC,CAAb,EAAgB;AAChCF,IAAAA,cAAa,GAAGG,MAAM,CAACC,cAAP,IACX;AAAEC,MAAAA,SAAS,EAAE;AAAb,iBAA6BC,KAA7B,IAAsC,UAAUL,CAAV,EAAaC,CAAb,EAAgB;AAAED,MAAAA,CAAC,CAACI,SAAF,GAAcH,CAAd;AAAkB,KAD/D,IAEZ,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AAAE,WAAK,IAAIK,CAAT,IAAcL,CAAd,EAAiB,IAAIA,CAAC,CAACM,cAAF,CAAiBD,CAAjB,CAAJ,EAAyBN,CAAC,CAACM,CAAD,CAAD,GAAOL,CAAC,CAACK,CAAD,CAAR;AAAc,KAF9E;;AAGA,WAAOP,cAAa,CAACC,CAAD,EAAIC,CAAJ,CAApB;AACH,GALD;;AAMA,SAAO,UAAUD,CAAV,EAAaC,CAAb,EAAgB;AACnBF,IAAAA,cAAa,CAACC,CAAD,EAAIC,CAAJ,CAAb;;AACA,aAASO,EAAT,GAAc;AAAE,WAAKC,WAAL,GAAmBT,CAAnB;AAAuB;;AACvCA,IAAAA,CAAC,CAACU,SAAF,GAAcT,CAAC,KAAK,IAAN,GAAaC,MAAM,CAACS,MAAP,CAAcV,CAAd,CAAb,IAAiCO,EAAE,CAACE,SAAH,GAAeT,CAAC,CAACS,SAAjB,EAA4B,IAAIF,EAAJ,EAA7D,CAAd;AACH,GAJD;AAKH,CAZ2C,EAA5C;;AAaAN,MAAM,CAACU,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIC,MAAM,GAAGC,OAAO,CAAC,SAAD,CAApB;;AACA,IAAIC,SAAS,GAAGD,OAAO,CAAC,YAAD,CAAvB;;AACA,IAAIE,MAAM,GAAGF,OAAO,CAAC,SAAD,CAApB;;AACA,IAAIG,OAAO,GAAGH,OAAO,CAAC,UAAD,CAArB;;AACA,IAAII,MAAM,GAAGJ,OAAO,CAAC,QAAD,CAApB;;AACA,IAAIK,OAAO,GAAGL,OAAO,CAAC,UAAD,CAArB;;AACA,IAAIM,QAAQ,GAAGN,OAAO,CAAC,WAAD,CAAtB;;AACA,IAAIO,YAAY,GAAGP,OAAO,CAAC,eAAD,CAA1B;;AACA,IAAIQ,QAAQ,GAAGR,OAAO,CAAC,WAAD,CAAtB;;AACA,IAAIS,gBAAgB,GAAG,CACnB,qBADmB,EAEnB,0BAFmB,EAGnB,qBAHmB,EAInB,sBAJmB,EAKnB,kBALmB,EAMnB,qBANmB,EAOnB,oBAPmB,EAQnB,yBARmB,EASnB,kBATmB,EAUnB,oBAVmB,EAWnB,yBAXmB,EAYnB,kBAZmB,EAanB,0BAbmB,EAcnB,oBAdmB,EAerBC,IAfqB,CAehB,GAfgB,CAAvB;AAgBA,IAAIC,SAAS,GAAG,UAAhB;AACA,IAAIC,oBAAoB,GAAG,CACvB,gBADuB,EAEvB,iBAFuB,EAGvB,iBAHuB,EAIvB,iBAJuB,EAKvB,gBALuB,EAMvB,gBANuB,EAOvB,mBAPuB,EAQvB,kBARuB,EASvB,kBATuB,EAUvB,4BAVuB,EAWvB,sBAXuB,EAYzBF,IAZyB,CAYpB,GAZoB,CAA3B;AAaA,IAAIG,MAAM,GAAG;AACT,cAAY,CAAC,EADJ;AAET,gBAAc,CAFL;AAGT,eAAa,EAHJ;AAIT,kBAAgB,CAAC,EAJR;AAKT,iBAAe,EALN;AAMT,iBAAe,CAAC,GANP;AAOT,mBAAiB,GAPR;AAQT,kBAAgB;AARP,CAAb;;AAUA,SAASC,SAAT,CAAmBC,UAAnB,EAA+BC,GAA/B,EAAoCC,UAApC,EAAgD;AAC5C,MAAIF,UAAU,KAAK,SAAnB,EAA8B;AAC1B,WAAO,WAAP;AACH;;AACDC,EAAAA,GAAG,IAAIjB,MAAM,CAACmB,IAAP,CAAYC,SAAZ,CAAsBN,MAAM,CAACE,UAAD,CAAN,IAAsB,CAA5C,CAAP;;AACA,MAAIE,UAAJ,EAAgB;AACZD,IAAAA,GAAG,IAAI,CAAC,CAAR;AACH;;AACD,MAAII,KAAK,GAAG,CAAErB,MAAM,CAACmB,IAAP,CAAYG,SAAZ,CAAsBL,GAAtB,IAA6B,GAA9B,GAAqC,GAAtC,IAA6C,GAAzD;;AACA,MAAIjB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,MAAM,IAAlC,EAAwC,GAAxC,KAAgDrB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,CAA5B,EAA+B,IAA/B,CAApD,EAA0F;AACtF,WAAO,WAAP;AACH,GAFD,MAGK,IAAIrB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,KAAK,IAAjC,EAAuC,KAAK,IAA5C,CAAJ,EAAuD;AACxD,WAAO,aAAP;AACH,GAFI,MAGA,IAAIrB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,KAAK,IAAjC,EAAuC,KAAK,IAA5C,CAAJ,EAAuD;AACxD,WAAO,WAAP;AACH,GAFI,MAGA,IAAIrB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,MAAM,IAAlC,EAAwC,MAAM,IAA9C,CAAJ,EAAyD;AAC1D,WAAO,aAAP;AACH,GAFI,MAGA,IAAIrB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,MAAM,IAAlC,EAAwC,MAAM,IAA9C,CAAJ,EAAyD;AAC1D,WAAO,WAAP;AACH,GAFI,MAGA,IAAIrB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,MAAM,IAAlC,EAAwC,MAAM,IAA9C,CAAJ,EAAyD;AAC1D,WAAO,aAAP;AACH,GAFI,MAGA,IAAIrB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,MAAM,IAAlC,EAAwC,MAAM,IAA9C,CAAJ,EAAyD;AAC1D,WAAO,WAAP;AACH,GAFI,MAGA,IAAIrB,MAAM,CAACmB,IAAP,CAAYI,QAAZ,CAAqBF,KAArB,EAA4B,MAAM,IAAlC,EAAwC,MAAM,IAA9C,CAAJ,EAAyD;AAC1D,WAAO,aAAP;AACH,GAFI,MAGA;AACDrB,IAAAA,MAAM,CAACmB,IAAP,CAAYK,KAAZ,CAAkB,yDAAyDH,KAA3E;AACA,WAAO,SAAP;AACH;AACJ;;AACD,IAAII,aAAa,GAAG,CAChB,UADgB,EAEhB,YAFgB,EAGhB,WAHgB,EAIhB,cAJgB,EAKhB,aALgB,EAMhB,aANgB,EAOhB,eAPgB,EAQhB,cARgB,CAApB;AAUA,IAAIC,gBAAgB,GAAG,SAAvB;;AACA,IAAIC,WAAW,GAAI,UAAUC,MAAV,EAAkB;AACjC7C,EAAAA,SAAS,CAAC4C,WAAD,EAAcC,MAAd,CAAT;;AACA,WAASD,WAAT,CAAqBE,MAArB,EAA6B;AACzB,QAAIC,KAAK,GAAGF,MAAM,CAACG,IAAP,CAAY,IAAZ,EAAkBF,MAAlB,KAA6B,IAAzC;;AACAC,IAAAA,KAAK,CAACE,aAAN,GAAsB,KAAtB;;AACAF,IAAAA,KAAK,CAACG,eAAN;;AACAH,IAAAA,KAAK,CAACI,gBAAN,GAAyBJ,KAAK,CAACI,gBAAN,CAAuBC,IAAvB,CAA4BL,KAA5B,CAAzB;AACAA,IAAAA,KAAK,CAACM,cAAN,GAAuBN,KAAK,CAACM,cAAN,CAAqBD,IAArB,CAA0BL,KAA1B,CAAvB;AACAA,IAAAA,KAAK,CAACO,MAAN,GAAeP,KAAK,CAACO,MAAN,CAAaF,IAAb,CAAkBL,KAAlB,CAAf;;AACAA,IAAAA,KAAK,CAACQ,EAAN,CAAS5B,gBAAT,EAA2BoB,KAAK,CAACO,MAAjC;;AACA,QAAIP,KAAK,CAACS,OAAN,EAAJ,EAAqB;AACjBT,MAAAA,KAAK,CAACO,MAAN;AACH;;AACD,WAAOP,KAAP;AACH;;AACDH,EAAAA,WAAW,CAAChC,SAAZ,CAAsB6C,QAAtB,GAAiC,UAAUC,IAAV,EAAgB;AAC7C,SAAKC,OAAL,CAAaD,IAAb;AACA,WAAO,IAAP;AACH,GAHD;;AAIAd,EAAAA,WAAW,CAAChC,SAAZ,CAAsB+C,OAAtB,GAAgC,UAAUD,IAAV,EAAgB;AAC5C,QAAIX,KAAK,GAAG,IAAZ;;AACA,QAAI,KAAKa,KAAT,EAAgB;AACZ,WAAKC,MAAL;AACH;;AACD,SAAKD,KAAL,GAAaF,IAAb;;AACA,SAAKI,oBAAL;;AACA,QAAIC,gBAAgB,GAAGL,IAAI,CAACM,mBAAL,CAClBC,GADkB,CACd,UAAUC,IAAV,EAAgB;AAAE,aAAOA,IAAI,GAAG,WAAd;AAA4B,KADhC,EAElBtC,IAFkB,CAEb,GAFa,CAAvB;;AAGA,QAAIuC,QAAQ,GAAG,SAAXA,QAAW,GAAY;AACvBpB,MAAAA,KAAK,CAACe,oBAAN;;AACA,UAAI,CAACf,KAAK,CAACE,aAAX,EAA0B;AACtBF,QAAAA,KAAK,CAACO,MAAN;AACH;AACJ,KALD;;AAMAI,IAAAA,IAAI,CAACH,EAAL,CAAQQ,gBAAR,EAA0BI,QAA1B;AACAT,IAAAA,IAAI,CAACH,EAAL,CAAQzB,oBAAR,EAA8BqC,QAA9B;AACAT,IAAAA,IAAI,CAACH,EAAL,CAAQ,uBAAR,EAAiC,YAAY;AAAE,aAAOR,KAAK,CAACe,oBAAN,EAAP;AAAsC,KAArF;AACA,QAAIM,eAAe,GAAG,CAAC,CAAC,KAAKC,OAAL,CAAa,WAAb,CAAxB;;AACA,QAAID,eAAJ,EAAqB;AACjB,WAAKd,MAAL;AACH;;AACD,WAAO,IAAP;AACH,GAxBD;;AAyBAV,EAAAA,WAAW,CAAChC,SAAZ,CAAsB4C,OAAtB,GAAgC,YAAY;AACxC,WAAO,KAAKI,KAAZ;AACH,GAFD;;AAGAhB,EAAAA,WAAW,CAAChC,SAAZ,CAAsBiD,MAAtB,GAA+B,YAAY;AACvC,QAAI,KAAKL,OAAL,EAAJ,EAAoB;AAChB,WAAKA,OAAL,GAAec,GAAf,CAAmB,KAAnB;AACA,WAAKV,KAAL,GAAaW,SAAb;AACH;;AACD,SAAKT,oBAAL;AACH,GAND;;AAOAlB,EAAAA,WAAW,CAAChC,SAAZ,CAAsBkD,oBAAtB,GAA6C,YAAY;AACrD,SAAKU,WAAL,CAAiB3C,SAAjB;;AACA,SAAK2C,WAAL,CAAiB,WAAjB;;AACA,SAAKC,4BAAL,CAAkC,mBAAlC;AACH,GAJD;;AAKA7B,EAAAA,WAAW,CAAChC,SAAZ,CAAsB8D,YAAtB,GAAqC,YAAY;AAC7C,WAAO,KAAKC,SAAL,CAAe9C,SAAf,EAA0B,KAAK+C,aAA/B,CAAP;AACH,GAFD;;AAGAhC,EAAAA,WAAW,CAAChC,SAAZ,CAAsBgE,aAAtB,GAAsC,YAAY;AAC9C,QAAIlB,IAAI,GAAG,KAAKF,OAAL,EAAX;;AACA,QAAI,CAACE,IAAL,EAAW;AACP,aAAO;AACHmB,QAAAA,CAAC,EAAE,CAAClC,gBADD;AAEHmC,QAAAA,CAAC,EAAE,CAACnC,gBAFD;AAGHoC,QAAAA,KAAK,EAAE,CAHJ;AAIHC,QAAAA,MAAM,EAAE,CAJL;AAKHC,QAAAA,QAAQ,EAAE;AALP,OAAP;AAOH;;AACD,QAAIC,IAAI,GAAGxB,IAAI,CAACyB,aAAL,CAAmB;AAC1BC,MAAAA,aAAa,EAAE,IADW;AAE1BC,MAAAA,UAAU,EAAE,IAFc;AAG1BC,MAAAA,UAAU,EAAE,KAAKC,YAAL;AAHc,KAAnB,CAAX;AAKA,QAAIN,QAAQ,GAAGzD,QAAQ,CAACgE,KAAT,CAAeC,QAAf,CAAwB/B,IAAI,CAACuB,QAAL,EAAxB,CAAf;AACA,QAAIS,EAAE,GAAGR,IAAI,CAACL,CAAL,GAASnB,IAAI,CAACiC,MAAL,EAAT,GAAyBjC,IAAI,CAACkC,OAAL,KAAiBlC,IAAI,CAACiC,MAAL,EAAnD;AACA,QAAIE,EAAE,GAAGX,IAAI,CAACJ,CAAL,GAASpB,IAAI,CAACoC,MAAL,EAAT,GAAyBpC,IAAI,CAACqC,OAAL,KAAiBrC,IAAI,CAACoC,MAAL,EAAnD;AACA,WAAO;AACHjB,MAAAA,CAAC,EAAEnB,IAAI,CAACmB,CAAL,KAAWa,EAAE,GAAGM,IAAI,CAACC,GAAL,CAAShB,QAAT,CAAhB,GAAqCY,EAAE,GAAGG,IAAI,CAACE,GAAL,CAAS,CAACjB,QAAV,CAD1C;AAEHH,MAAAA,CAAC,EAAEpB,IAAI,CAACoB,CAAL,KAAWe,EAAE,GAAGG,IAAI,CAACC,GAAL,CAAShB,QAAT,CAAhB,GAAqCS,EAAE,GAAGM,IAAI,CAACE,GAAL,CAASjB,QAAT,CAF1C;AAGHF,MAAAA,KAAK,EAAEG,IAAI,CAACH,KAAL,GAAarB,IAAI,CAACiC,MAAL,EAHjB;AAIHX,MAAAA,MAAM,EAAEE,IAAI,CAACF,MAAL,GAActB,IAAI,CAACoC,MAAL,EAJnB;AAKHb,MAAAA,QAAQ,EAAEvB,IAAI,CAACuB,QAAL;AALP,KAAP;AAOH,GA1BD;;AA2BArC,EAAAA,WAAW,CAAChC,SAAZ,CAAsBuF,IAAtB,GAA6B,YAAY;AACrC,WAAO,KAAKzB,YAAL,GAAoBG,CAA3B;AACH,GAFD;;AAGAjC,EAAAA,WAAW,CAAChC,SAAZ,CAAsBwF,IAAtB,GAA6B,YAAY;AACrC,WAAO,KAAK1B,YAAL,GAAoBI,CAA3B;AACH,GAFD;;AAGAlC,EAAAA,WAAW,CAAChC,SAAZ,CAAsByF,WAAtB,GAAoC,YAAY;AAC5C,WAAO,KAAK3B,YAAL,GAAoBO,QAA3B;AACH,GAFD;;AAGArC,EAAAA,WAAW,CAAChC,SAAZ,CAAsB0F,QAAtB,GAAiC,YAAY;AACzC,WAAO,KAAK5B,YAAL,GAAoBK,KAA3B;AACH,GAFD;;AAGAnC,EAAAA,WAAW,CAAChC,SAAZ,CAAsB2F,SAAtB,GAAkC,YAAY;AAC1C,WAAO,KAAK7B,YAAL,GAAoBM,MAA3B;AACH,GAFD;;AAGApC,EAAAA,WAAW,CAAChC,SAAZ,CAAsBsC,eAAtB,GAAwC,YAAY;AAChD,SAAKsD,WAAL;;AACA9D,IAAAA,aAAa,CAAC+D,OAAd,CAAsB,UAAUC,IAAV,EAAgB;AAClC,WAAKC,aAAL,CAAmBD,IAAnB;AACH,KAFqB,CAEpBtD,IAFoB,CAEf,IAFe,CAAtB;;AAGA,SAAKuD,aAAL,CAAmB,SAAnB;AACH,GAND;;AAOA/D,EAAAA,WAAW,CAAChC,SAAZ,CAAsB+F,aAAtB,GAAsC,UAAUD,IAAV,EAAgB;AAClD,QAAIE,MAAM,GAAG,IAAItF,MAAM,CAACuF,IAAX,CAAgB;AACzBC,MAAAA,MAAM,EAAE,kBADiB;AAEzBC,MAAAA,IAAI,EAAE,OAFmB;AAGzBC,MAAAA,WAAW,EAAE,CAHY;AAIzBN,MAAAA,IAAI,EAAEA,IAAI,GAAG,UAJY;AAKzBO,MAAAA,YAAY,EAAE,CALW;AAMzBC,MAAAA,SAAS,EAAE;AANc,KAAhB,CAAb;AAQA,QAAIC,IAAI,GAAG,IAAX;AACAP,IAAAA,MAAM,CAACrD,EAAP,CAAU,sBAAV,EAAkC,UAAU6D,CAAV,EAAa;AAC3CD,MAAAA,IAAI,CAACE,gBAAL,CAAsBD,CAAtB;AACH,KAFD;AAGAR,IAAAA,MAAM,CAACrD,EAAP,CAAU,WAAV,EAAuB,UAAU6D,CAAV,EAAa;AAChCA,MAAAA,CAAC,CAACE,YAAF,GAAiB,IAAjB;AACH,KAFD;AAGAV,IAAAA,MAAM,CAACrD,EAAP,CAAU,UAAV,EAAsB,UAAU6D,CAAV,EAAa;AAC/BA,MAAAA,CAAC,CAACE,YAAF,GAAiB,IAAjB;AACH,KAFD;AAGAV,IAAAA,MAAM,CAACrD,EAAP,CAAU,SAAV,EAAqB,UAAU6D,CAAV,EAAa;AAC9BA,MAAAA,CAAC,CAACE,YAAF,GAAiB,IAAjB;AACH,KAFD;AAGAV,IAAAA,MAAM,CAACrD,EAAP,CAAU,YAAV,EAAwB,YAAY;AAChC,UAAIgE,EAAE,GAAG,KAAKC,SAAL,EAAT;AACA,UAAItF,GAAG,GAAGV,QAAQ,CAACgE,KAAT,CAAeC,QAAf,CAAwB8B,EAAE,CAACtC,QAAH,EAAxB,CAAV;AACA,UAAIwC,KAAK,GAAGF,EAAE,CAAC/D,OAAH,GAAakE,gBAAb,EAAZ;AACA,UAAIvF,UAAU,GAAGsF,KAAK,CAAC3C,CAAN,GAAU2C,KAAK,CAAC5C,CAAhB,GAAoB,CAArC;AACA,UAAI8C,MAAM,GAAG3F,SAAS,CAAC0E,IAAD,EAAOxE,GAAP,EAAYC,UAAZ,CAAtB;AACAyE,MAAAA,MAAM,CAACgB,QAAP,GAAkBC,OAAlB,CAA0BC,KAA1B,CAAgCH,MAAhC,GAAyCA,MAAzC;AACAJ,MAAAA,EAAE,CAACQ,aAAH,GAAmB,IAAnB;AACH,KARD;AASAnB,IAAAA,MAAM,CAACrD,EAAP,CAAU,UAAV,EAAsB,YAAY;AAC9B,UAAI,CAACqD,MAAM,CAACgB,QAAP,EAAD,IAAsB,CAAC,KAAKJ,SAAL,EAA3B,EAA6C;AACzC;AACH;;AACDZ,MAAAA,MAAM,CAACgB,QAAP,GAAkBC,OAAlB,CAA0BC,KAA1B,CAAgCH,MAAhC,GAAyC,EAAzC;AACA,WAAKH,SAAL,GAAiBO,aAAjB,GAAiC,KAAjC;AACH,KAND;AAOA,SAAKC,GAAL,CAASpB,MAAT;AACH,GAvCD;;AAwCAhE,EAAAA,WAAW,CAAChC,SAAZ,CAAsB4F,WAAtB,GAAoC,YAAY;AAC5C,QAAIyB,IAAI,GAAG,IAAI5G,OAAO,CAAC6G,KAAZ,CAAkB;AACzBxB,MAAAA,IAAI,EAAE,MADmB;AAEzB3B,MAAAA,KAAK,EAAE,CAFkB;AAGzBC,MAAAA,MAAM,EAAE,CAHiB;AAIzBmD,MAAAA,SAAS,EAAE,KAJc;AAKzBC,MAAAA,SAAS,EAAE,mBAAUC,GAAV,EAAe;AACtB,YAAId,EAAE,GAAG,KAAKC,SAAL,EAAT;AACA,YAAIc,OAAO,GAAGf,EAAE,CAACe,OAAH,EAAd;AACAD,QAAAA,GAAG,CAACE,SAAJ;AACAF,QAAAA,GAAG,CAACnD,IAAJ,CAAS,CAACoD,OAAV,EAAmB,CAACA,OAApB,EAA6B,KAAKvD,KAAL,KAAeuD,OAAO,GAAG,CAAtD,EAAyD,KAAKtD,MAAL,KAAgBsD,OAAO,GAAG,CAAnF;AACAD,QAAAA,GAAG,CAACG,MAAJ,CAAW,KAAKzD,KAAL,KAAe,CAA1B,EAA6B,CAACuD,OAA9B;;AACA,YAAIf,EAAE,CAACkB,aAAH,EAAJ,EAAwB;AACpBJ,UAAAA,GAAG,CAACK,MAAJ,CAAW,KAAK3D,KAAL,KAAe,CAA1B,EAA6B,CAACwC,EAAE,CAACoB,kBAAH,EAAD,GAA2B1H,MAAM,CAACmB,IAAP,CAAYwG,KAAZ,CAAkB,KAAK5D,MAAL,EAAlB,CAAxD;AACH;;AACDqD,QAAAA,GAAG,CAACQ,eAAJ,CAAoB,IAApB;AACH;AAfwB,KAAlB,CAAX;AAiBA,SAAKb,GAAL,CAASC,IAAT;AACH,GAnBD;;AAoBArF,EAAAA,WAAW,CAAChC,SAAZ,CAAsByG,gBAAtB,GAAyC,UAAUD,CAAV,EAAa;AAClD,SAAK0B,aAAL,GAAqB1B,CAAC,CAAC2B,MAAF,CAASrC,IAAT,GAAgBsC,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAArB;;AACA,QAAIC,KAAK,GAAG,KAAKvE,YAAL,EAAZ;;AACA,QAAIK,KAAK,GAAGkE,KAAK,CAAClE,KAAlB;AACA,QAAIC,MAAM,GAAGiE,KAAK,CAACjE,MAAnB;AACA,QAAIkE,UAAU,GAAGlD,IAAI,CAACmD,IAAL,CAAUnD,IAAI,CAACoD,GAAL,CAASrE,KAAT,EAAgB,CAAhB,IAAqBiB,IAAI,CAACoD,GAAL,CAASpE,MAAT,EAAiB,CAAjB,CAA/B,CAAjB;AACA,SAAKkB,GAAL,GAAWlB,MAAM,GAAGkE,UAApB;AACA,SAAKjD,GAAL,GAAWlB,KAAK,GAAGmE,UAAnB;AACAG,IAAAA,MAAM,CAACC,gBAAP,CAAwB,WAAxB,EAAqC,KAAKnG,gBAA1C;AACAkG,IAAAA,MAAM,CAACC,gBAAP,CAAwB,WAAxB,EAAqC,KAAKnG,gBAA1C;AACAkG,IAAAA,MAAM,CAACC,gBAAP,CAAwB,SAAxB,EAAmC,KAAKjG,cAAxC,EAAwD,IAAxD;AACAgG,IAAAA,MAAM,CAACC,gBAAP,CAAwB,UAAxB,EAAoC,KAAKjG,cAAzC,EAAyD,IAAzD;AACA,SAAKJ,aAAL,GAAqB,IAArB;;AACA,SAAKsG,KAAL,CAAW,gBAAX,EAA6B;AAAEC,MAAAA,GAAG,EAAEpC;AAAP,KAA7B;;AACA,SAAK5D,OAAL,GAAe+F,KAAf,CAAqB,gBAArB,EAAuC;AAAEC,MAAAA,GAAG,EAAEpC;AAAP,KAAvC;AACH,GAfD;;AAgBAxE,EAAAA,WAAW,CAAChC,SAAZ,CAAsBuC,gBAAtB,GAAyC,UAAUiE,CAAV,EAAa;AAClD,QAAIvC,CAAJ,EAAOC,CAAP,EAAU2E,aAAV;AACA,QAAIC,WAAW,GAAG,KAAKrF,OAAL,CAAa,MAAM,KAAKyE,aAAxB,CAAlB;AACA,QAAIa,KAAK,GAAGD,WAAW,CAAC9B,QAAZ,EAAZ;AACA,QAAIgC,GAAG,GAAGD,KAAK,CAACE,UAAN,GAAmBC,qBAAnB,EAAV;AACA,QAAIC,SAAS,GAAG;AACZlF,MAAAA,CAAC,EAAE+E,GAAG,CAACI,IADK;AAEZlF,MAAAA,CAAC,EAAE8E,GAAG,CAACK;AAFK,KAAhB;AAIA,QAAIC,UAAU,GAAG;AACbF,MAAAA,IAAI,EAAE5C,CAAC,CAAC+C,OAAF,KAAc5F,SAAd,GAA0B6C,CAAC,CAAC+C,OAA5B,GAAsC/C,CAAC,CAACgD,OAAF,CAAU,CAAV,EAAaD,OAD5C;AAEbF,MAAAA,GAAG,EAAE7C,CAAC,CAAC+C,OAAF,KAAc5F,SAAd,GAA0B6C,CAAC,CAACiD,OAA5B,GAAsCjD,CAAC,CAACgD,OAAF,CAAU,CAAV,EAAaC;AAF3C,KAAjB;AAIA,QAAIC,SAAS,GAAG;AACZzF,MAAAA,CAAC,EAAEqF,UAAU,CAACF,IAAX,GAAkBD,SAAS,CAAClF,CADnB;AAEZC,MAAAA,CAAC,EAAEoF,UAAU,CAACD,GAAX,GAAiBF,SAAS,CAACjF;AAFlB,KAAhB;AAIA4E,IAAAA,WAAW,CAACa,mBAAZ,CAAgCD,SAAhC;AACA,QAAIE,cAAc,GAAG,KAAKC,SAAL,MAAoBrD,CAAC,CAACsD,QAA3C;;AACA,QAAI,KAAK5B,aAAL,KAAuB,UAA3B,EAAuC;AACnC,UAAI0B,cAAJ,EAAoB;AAChBf,QAAAA,aAAa,GAAGzD,IAAI,CAACmD,IAAL,CAAUnD,IAAI,CAACoD,GAAL,CAAS,KAAK/E,OAAL,CAAa,eAAb,EAA8BQ,CAA9B,KAAoC6E,WAAW,CAAC7E,CAAZ,EAA7C,EAA8D,CAA9D,IACtBmB,IAAI,CAACoD,GAAL,CAAS,KAAK/E,OAAL,CAAa,eAAb,EAA8BS,CAA9B,KAAoC4E,WAAW,CAAC5E,CAAZ,EAA7C,EAA8D,CAA9D,CADY,CAAhB;AAEAD,QAAAA,CAAC,GAAG4E,aAAa,GAAG,KAAKxD,GAAzB;AACAnB,QAAAA,CAAC,GAAG2E,aAAa,GAAG,KAAKvD,GAAzB;AACA,aAAK7B,OAAL,CAAa,WAAb,EAA0BQ,CAA1B,CAA4B,KAAKR,OAAL,CAAa,eAAb,EAA8BQ,CAA9B,KAAoCA,CAAhE;AACA,aAAKR,OAAL,CAAa,WAAb,EAA0BS,CAA1B,CAA4B,KAAKT,OAAL,CAAa,eAAb,EAA8BS,CAA9B,KAAoCA,CAAhE;AACH;AACJ,KATD,MAUK,IAAI,KAAKgE,aAAL,KAAuB,YAA3B,EAAyC;AAC1C,WAAKzE,OAAL,CAAa,WAAb,EAA0BS,CAA1B,CAA4B4E,WAAW,CAAC5E,CAAZ,EAA5B;AACH,KAFI,MAGA,IAAI,KAAKgE,aAAL,KAAuB,WAA3B,EAAwC;AACzC,UAAI0B,cAAJ,EAAoB;AAChBf,QAAAA,aAAa,GAAGzD,IAAI,CAACmD,IAAL,CAAUnD,IAAI,CAACoD,GAAL,CAAS,KAAK/E,OAAL,CAAa,cAAb,EAA6BQ,CAA7B,KAAmC6E,WAAW,CAAC7E,CAAZ,EAA5C,EAA6D,CAA7D,IACtBmB,IAAI,CAACoD,GAAL,CAAS,KAAK/E,OAAL,CAAa,cAAb,EAA6BS,CAA7B,KAAmC4E,WAAW,CAAC5E,CAAZ,EAA5C,EAA6D,CAA7D,CADY,CAAhB;AAEAD,QAAAA,CAAC,GAAG4E,aAAa,GAAG,KAAKxD,GAAzB;AACAnB,QAAAA,CAAC,GAAG2E,aAAa,GAAG,KAAKvD,GAAzB;AACA,aAAK7B,OAAL,CAAa,YAAb,EAA2BQ,CAA3B,CAA6BA,CAA7B;AACA,aAAKR,OAAL,CAAa,YAAb,EAA2BS,CAA3B,CAA6B,KAAKT,OAAL,CAAa,cAAb,EAA6BS,CAA7B,KAAmCA,CAAhE;AACH;;AACD,UAAI6F,GAAG,GAAGjB,WAAW,CAACkB,QAAZ,EAAV;AACA,WAAKvG,OAAL,CAAa,WAAb,EAA0BS,CAA1B,CAA4B6F,GAAG,CAAC7F,CAAhC;AACA,WAAKT,OAAL,CAAa,eAAb,EAA8BQ,CAA9B,CAAgC8F,GAAG,CAAC9F,CAApC;AACH,KAZI,MAaA,IAAI,KAAKiE,aAAL,KAAuB,aAA3B,EAA0C;AAC3C,WAAKzE,OAAL,CAAa,WAAb,EAA0BQ,CAA1B,CAA4B6E,WAAW,CAAC7E,CAAZ,EAA5B;AACH,KAFI,MAGA,IAAI,KAAKiE,aAAL,KAAuB,cAA3B,EAA2C;AAC5C,WAAKzE,OAAL,CAAa,eAAb,EAA8BQ,CAA9B,CAAgC6E,WAAW,CAAC7E,CAAZ,EAAhC;AACH,KAFI,MAGA,IAAI,KAAKiE,aAAL,KAAuB,aAA3B,EAA0C;AAC3C,UAAI0B,cAAJ,EAAoB;AAChBf,QAAAA,aAAa,GAAGzD,IAAI,CAACmD,IAAL,CAAUnD,IAAI,CAACoD,GAAL,CAAS,KAAK/E,OAAL,CAAa,YAAb,EAA2BQ,CAA3B,KAAiC6E,WAAW,CAAC7E,CAAZ,EAA1C,EAA2D,CAA3D,IACtBmB,IAAI,CAACoD,GAAL,CAAS,KAAK/E,OAAL,CAAa,YAAb,EAA2BS,CAA3B,KAAiC4E,WAAW,CAAC5E,CAAZ,EAA1C,EAA2D,CAA3D,CADY,CAAhB;AAEAD,QAAAA,CAAC,GAAG4E,aAAa,GAAG,KAAKxD,GAAzB;AACAnB,QAAAA,CAAC,GAAG2E,aAAa,GAAG,KAAKvD,GAAzB;AACA,aAAK7B,OAAL,CAAa,cAAb,EAA6BQ,CAA7B,CAA+B,KAAKR,OAAL,CAAa,YAAb,EAA2BQ,CAA3B,KAAiCA,CAAhE;AACA,aAAKR,OAAL,CAAa,cAAb,EAA6BS,CAA7B,CAA+BA,CAA/B;AACH;;AACD6F,MAAAA,GAAG,GAAGjB,WAAW,CAACkB,QAAZ,EAAN;AACA,WAAKvG,OAAL,CAAa,WAAb,EAA0BQ,CAA1B,CAA4B8F,GAAG,CAAC9F,CAAhC;AACA,WAAKR,OAAL,CAAa,eAAb,EAA8BS,CAA9B,CAAgC6F,GAAG,CAAC7F,CAApC;AACH,KAZI,MAaA,IAAI,KAAKgE,aAAL,KAAuB,eAA3B,EAA4C;AAC7C,WAAKzE,OAAL,CAAa,eAAb,EAA8BS,CAA9B,CAAgC4E,WAAW,CAAC5E,CAAZ,EAAhC;AACH,KAFI,MAGA,IAAI,KAAKgE,aAAL,KAAuB,cAA3B,EAA2C;AAC5C,UAAI0B,cAAJ,EAAoB;AAChBf,QAAAA,aAAa,GAAGzD,IAAI,CAACmD,IAAL,CAAUnD,IAAI,CAACoD,GAAL,CAAS,KAAK/E,OAAL,CAAa,eAAb,EAA8BQ,CAA9B,EAAT,EAA4C,CAA5C,IACtBmB,IAAI,CAACoD,GAAL,CAAS,KAAK/E,OAAL,CAAa,eAAb,EAA8BS,CAA9B,EAAT,EAA4C,CAA5C,CADY,CAAhB;AAEAD,QAAAA,CAAC,GAAG4E,aAAa,GAAG,KAAKxD,GAAzB;AACAnB,QAAAA,CAAC,GAAG2E,aAAa,GAAG,KAAKvD,GAAzB;AACA,aAAK7B,OAAL,CAAa,eAAb,EAA8BQ,CAA9B,CAAgCA,CAAhC;AACA,aAAKR,OAAL,CAAa,eAAb,EAA8BS,CAA9B,CAAgCA,CAAhC;AACH;AACJ,KATI,MAUA,IAAI,KAAKgE,aAAL,KAAuB,SAA3B,EAAsC;AACvC,UAAIR,OAAO,GAAG,KAAKA,OAAL,EAAd;;AACA,UAAIW,KAAK,GAAG,KAAKvE,YAAL,EAAZ;;AACAG,MAAAA,CAAC,GAAG6E,WAAW,CAAC7E,CAAZ,KAAkBoE,KAAK,CAAClE,KAAN,GAAc,CAApC;AACAD,MAAAA,CAAC,GAAG,CAAC4E,WAAW,CAAC5E,CAAZ,EAAD,GAAmBmE,KAAK,CAACjE,MAAN,GAAe,CAAtC;AACA,UAAI6F,MAAM,GAAG7E,IAAI,CAAC8E,KAAL,CAAW,CAAChG,CAAZ,EAAeD,CAAf,IAAoBmB,IAAI,CAAC+E,EAAL,GAAU,CAA3C;;AACA,UAAI9B,KAAK,CAACjE,MAAN,GAAe,CAAnB,EAAsB;AAClB6F,QAAAA,MAAM,IAAI7E,IAAI,CAAC+E,EAAf;AACH;;AACD,UAAIC,GAAG,GAAGxJ,QAAQ,CAACgE,KAAT,CAAeC,QAAf,CAAwB,KAAKR,QAAL,EAAxB,CAAV;;AACA,UAAIgG,WAAW,GAAGhK,MAAM,CAACmB,IAAP,CAAYG,SAAZ,CAAsByI,GAAtB,IAA6B/J,MAAM,CAACmB,IAAP,CAAYG,SAAZ,CAAsBsI,MAAtB,CAA/C;;AACA,UAAIK,KAAK,GAAG1J,QAAQ,CAACgE,KAAT,CAAeC,QAAf,CAAwB,KAAKjC,OAAL,GAAeyB,QAAf,EAAxB,CAAZ;;AACA,UAAIkG,QAAQ,GAAGlK,MAAM,CAACmB,IAAP,CAAYC,SAAZ,CAAsB4I,WAAtB,CAAf;;AACA,UAAIG,KAAK,GAAG,KAAKC,aAAL,EAAZ;AACA,UAAIC,MAAM,GAAG,GAAb;;AACA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,KAAK,CAACI,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,YAAIjJ,KAAK,GAAGd,QAAQ,CAACgE,KAAT,CAAeC,QAAf,CAAwB2F,KAAK,CAACG,CAAD,CAA7B,CAAZ;AACA,YAAIE,GAAG,GAAGzF,IAAI,CAAC0F,GAAL,CAASpJ,KAAK,GAAGrB,MAAM,CAACmB,IAAP,CAAYC,SAAZ,CAAsB4I,WAAtB,CAAjB,KAAwDjF,IAAI,CAAC+E,EAAL,GAAU,CAAlE,CAAV;;AACA,YAAIU,GAAG,GAAGH,MAAV,EAAkB;AACdL,UAAAA,WAAW,GAAGhK,MAAM,CAACmB,IAAP,CAAYG,SAAZ,CAAsBD,KAAtB,CAAd;AACA6I,UAAAA,QAAQ,GAAGlK,MAAM,CAACmB,IAAP,CAAYC,SAAZ,CAAsB4I,WAAtB,CAAX;AACH;AACJ;;AACD,UAAIvF,EAAE,GAAG4C,OAAT;AACA,UAAIzC,EAAE,GAAGyC,OAAT;;AACA,WAAKqD,YAAL,CAAkB;AACd1G,QAAAA,QAAQ,EAAEzD,QAAQ,CAACgE,KAAT,CAAeoG,QAAf,GAA0BX,WAA1B,GAAwChK,MAAM,CAACmB,IAAP,CAAYC,SAAZ,CAAsB4I,WAAtB,CADpC;AAEdpG,QAAAA,CAAC,EAAEoE,KAAK,CAACpE,CAAN,GACC,CAACoE,KAAK,CAAClE,KAAN,GAAc,CAAd,GAAkBuD,OAAnB,KACKtC,IAAI,CAACC,GAAL,CAASiF,KAAT,IAAkBlF,IAAI,CAACC,GAAL,CAASkF,QAAT,CADvB,CADD,GAGC,CAAClC,KAAK,CAACjE,MAAN,GAAe,CAAf,GAAmBsD,OAApB,KACKtC,IAAI,CAACE,GAAL,CAAS,CAACgF,KAAV,IAAmBlF,IAAI,CAACE,GAAL,CAAS,CAACiF,QAAV,CADxB,CAHD,IAKEzF,EAAE,GAAGM,IAAI,CAACC,GAAL,CAAS+E,GAAT,CAAL,GAAqBnF,EAAE,GAAGG,IAAI,CAACE,GAAL,CAAS,CAAC8E,GAAV,CAL5B,CAFW;AAQdlG,QAAAA,CAAC,EAAEmE,KAAK,CAACnE,CAAN,GACC,CAACmE,KAAK,CAACjE,MAAN,GAAe,CAAf,GAAmBsD,OAApB,KACKtC,IAAI,CAACC,GAAL,CAASiF,KAAT,IAAkBlF,IAAI,CAACC,GAAL,CAASkF,QAAT,CADvB,CADD,GAGC,CAAClC,KAAK,CAAClE,KAAN,GAAc,CAAd,GAAkBuD,OAAnB,KACKtC,IAAI,CAACE,GAAL,CAASgF,KAAT,IAAkBlF,IAAI,CAACE,GAAL,CAASiF,QAAT,CADvB,CAHD,IAKEtF,EAAE,GAAGG,IAAI,CAACC,GAAL,CAAS+E,GAAT,CAAL,GAAqBtF,EAAE,GAAGM,IAAI,CAACE,GAAL,CAAS8E,GAAT,CAL5B,CARW;AAcdjG,QAAAA,KAAK,EAAEkE,KAAK,CAAClE,KAAN,GAAcuD,OAAO,GAAG,CAdjB;AAedtD,QAAAA,MAAM,EAAEiE,KAAK,CAACjE,MAAN,GAAesD,OAAO,GAAG;AAfnB,OAAlB,EAgBGlB,CAhBH;AAiBH,KA1CI,MA2CA;AACDyE,MAAAA,OAAO,CAACpJ,KAAR,CAAc,IAAIqJ,KAAJ,CAAU,mDAAmD,KAAKhD,aAAlE,CAAd;AACH;;AACD,QAAI,KAAKA,aAAL,KAAuB,SAA3B,EAAsC;AAClC;AACH;;AACD,QAAIiD,MAAM,GAAG,KAAK1H,OAAL,CAAa,WAAb,EAA0B2H,mBAA1B,CAA8C,KAAKxE,SAAL,EAA9C,CAAb;AACA,QAAIyE,eAAe,GAAG,KAAKA,eAAL,MAA0B7E,CAAC,CAAC8E,MAAlD;;AACA,QAAID,eAAJ,EAAqB;AACjB,UAAIE,OAAO,GAAG,KAAK9H,OAAL,CAAa,WAAb,CAAd;AACA,UAAI+H,WAAW,GAAG,KAAK/H,OAAL,CAAa,eAAb,CAAlB;AACA,UAAIgI,UAAU,GAAGF,OAAO,CAACtH,CAAR,EAAjB;AACA,UAAIyH,UAAU,GAAGH,OAAO,CAACrH,CAAR,EAAjB;AACA,UAAIyH,aAAa,GAAG,KAAKjG,QAAL,KAAkB8F,WAAW,CAACvH,CAAZ,EAAtC;AACA,UAAI2H,aAAa,GAAG,KAAKjG,SAAL,KAAmB6F,WAAW,CAACtH,CAAZ,EAAvC;AACAsH,MAAAA,WAAW,CAACK,IAAZ,CAAiB;AACb5H,QAAAA,CAAC,EAAE,CAACwH,UADS;AAEbvH,QAAAA,CAAC,EAAE,CAACwH;AAFS,OAAjB;AAIAH,MAAAA,OAAO,CAACM,IAAR,CAAa;AACT5H,QAAAA,CAAC,EAAE0H,aADM;AAETzH,QAAAA,CAAC,EAAE0H;AAFM,OAAb;AAIAT,MAAAA,MAAM,GAAGI,OAAO,CAACH,mBAAR,CAA4B,KAAKxE,SAAL,EAA5B,CAAT;AACH;;AACD3C,IAAAA,CAAC,GAAGkH,MAAM,CAAClH,CAAX;AACAC,IAAAA,CAAC,GAAGiH,MAAM,CAACjH,CAAX;AACA,QAAIC,KAAK,GAAG,KAAKV,OAAL,CAAa,eAAb,EAA8BQ,CAA9B,KAAoC,KAAKR,OAAL,CAAa,WAAb,EAA0BQ,CAA1B,EAAhD;AACA,QAAIG,MAAM,GAAG,KAAKX,OAAL,CAAa,eAAb,EAA8BS,CAA9B,KAAoC,KAAKT,OAAL,CAAa,WAAb,EAA0BS,CAA1B,EAAjD;;AACA,SAAK6G,YAAL,CAAkB;AACd9G,MAAAA,CAAC,EAAEA,CAAC,GAAG,KAAKe,OAAL,EADO;AAEdd,MAAAA,CAAC,EAAEA,CAAC,GAAG,KAAKiB,OAAL,EAFO;AAGdhB,MAAAA,KAAK,EAAEA,KAHO;AAIdC,MAAAA,MAAM,EAAEA;AAJM,KAAlB,EAKGoC,CALH;AAMH,GA3JD;;AA4JAxE,EAAAA,WAAW,CAAChC,SAAZ,CAAsByC,cAAtB,GAAuC,UAAU+D,CAAV,EAAa;AAChD,SAAKsF,aAAL,CAAmBtF,CAAnB;AACH,GAFD;;AAGAxE,EAAAA,WAAW,CAAChC,SAAZ,CAAsB8L,aAAtB,GAAsC,UAAUtF,CAAV,EAAa;AAC/C,QAAI,KAAKnE,aAAT,EAAwB;AACpB,WAAKA,aAAL,GAAqB,KAArB;AACAoG,MAAAA,MAAM,CAACsD,mBAAP,CAA2B,WAA3B,EAAwC,KAAKxJ,gBAA7C;AACAkG,MAAAA,MAAM,CAACsD,mBAAP,CAA2B,WAA3B,EAAwC,KAAKxJ,gBAA7C;AACAkG,MAAAA,MAAM,CAACsD,mBAAP,CAA2B,SAA3B,EAAsC,KAAKtJ,cAA3C,EAA2D,IAA3D;AACAgG,MAAAA,MAAM,CAACsD,mBAAP,CAA2B,UAA3B,EAAuC,KAAKtJ,cAA5C,EAA4D,IAA5D;;AACA,WAAKkG,KAAL,CAAW,cAAX,EAA2B;AAAEC,QAAAA,GAAG,EAAEpC;AAAP,OAA3B;;AACA,UAAI1D,IAAI,GAAG,KAAKF,OAAL,EAAX;;AACA,UAAIE,IAAJ,EAAU;AACNA,QAAAA,IAAI,CAACkJ,IAAL,CAAU,cAAV,EAA0B;AAAEpD,UAAAA,GAAG,EAAEpC;AAAP,SAA1B;AACH;AACJ;AACJ,GAbD;;AAcAxE,EAAAA,WAAW,CAAChC,SAAZ,CAAsB+K,YAAtB,GAAqC,UAAUkB,QAAV,EAAoBrD,GAApB,EAAyB;AAC1D,QAAIsD,YAAY,GAAG,KAAKA,YAAL,EAAnB;;AACA,QAAIA,YAAJ,EAAkB;AACd,UAAIC,QAAQ,GAAG,KAAKrI,YAAL,EAAf;;AACAmI,MAAAA,QAAQ,GAAGC,YAAY,CAAC9J,IAAb,CAAkB,IAAlB,EAAwB+J,QAAxB,EAAkCF,QAAlC,CAAX;AACH;;AACD,QAAInJ,IAAI,GAAG,KAAKF,OAAL,EAAX;;AACA,QAAIqJ,QAAQ,CAAC5H,QAAT,KAAsBV,SAA1B,EAAqC;AACjC,WAAKf,OAAL,GAAeyB,QAAf,CAAwB4H,QAAQ,CAAC5H,QAAjC;AACH;;AACD,QAAI+H,IAAI,GAAGtJ,IAAI,CAACyB,aAAL,CAAmB;AAC1BC,MAAAA,aAAa,EAAE,IADW;AAE1BC,MAAAA,UAAU,EAAE,IAFc;AAG1BC,MAAAA,UAAU,EAAE,KAAKC,YAAL;AAHc,KAAnB,CAAX;AAKA,QAAI+C,OAAO,GAAG,KAAKA,OAAL,EAAd;AACA,QAAI3C,MAAM,GAAG,CAACkH,QAAQ,CAAC9H,KAAT,GAAiBuD,OAAO,GAAG,CAA5B,IAAiC0E,IAAI,CAACjI,KAAnD;AACA,QAAIe,MAAM,GAAG,CAAC+G,QAAQ,CAAC7H,MAAT,GAAkBsD,OAAO,GAAG,CAA7B,IAAkC0E,IAAI,CAAChI,MAApD;AACA,QAAIC,QAAQ,GAAGzD,QAAQ,CAACgE,KAAT,CAAeC,QAAf,CAAwB/B,IAAI,CAACuB,QAAL,EAAxB,CAAf;AACA,QAAIS,EAAE,GAAGsH,IAAI,CAACnI,CAAL,GAASc,MAAT,GAAkB2C,OAAlB,GAA4B5E,IAAI,CAACkC,OAAL,KAAiBD,MAAtD;AACA,QAAIE,EAAE,GAAGmH,IAAI,CAAClI,CAAL,GAASgB,MAAT,GAAkBwC,OAAlB,GAA4B5E,IAAI,CAACqC,OAAL,KAAiBD,MAAtD;AACA,SAAKtC,OAAL,GAAeyJ,QAAf,CAAwB;AACpBtH,MAAAA,MAAM,EAAEA,MADY;AAEpBG,MAAAA,MAAM,EAAEA,MAFY;AAGpBjB,MAAAA,CAAC,EAAEgI,QAAQ,CAAChI,CAAT,IAAca,EAAE,GAAGM,IAAI,CAACC,GAAL,CAAShB,QAAT,CAAL,GAA0BY,EAAE,GAAGG,IAAI,CAACE,GAAL,CAAS,CAACjB,QAAV,CAA7C,CAHiB;AAIpBH,MAAAA,CAAC,EAAE+H,QAAQ,CAAC/H,CAAT,IAAce,EAAE,GAAGG,IAAI,CAACC,GAAL,CAAShB,QAAT,CAAL,GAA0BS,EAAE,GAAGM,IAAI,CAACE,GAAL,CAASjB,QAAT,CAA7C;AAJiB,KAAxB;;AAMA,SAAKsE,KAAL,CAAW,WAAX,EAAwB;AAAEC,MAAAA,GAAG,EAAEA;AAAP,KAAxB;;AACA,SAAKhG,OAAL,GAAe+F,KAAf,CAAqB,WAArB,EAAkC;AAAEC,MAAAA,GAAG,EAAEA;AAAP,KAAlC;;AACA,SAAKlG,MAAL;AACA,SAAK4J,QAAL,GAAgBC,SAAhB;AACH,GA/BD;;AAgCAvK,EAAAA,WAAW,CAAChC,SAAZ,CAAsBwM,WAAtB,GAAoC,YAAY;AAC5C,SAAKtJ,oBAAL;;AACA,SAAKR,MAAL;AACH,GAHD;;AAIAV,EAAAA,WAAW,CAAChC,SAAZ,CAAsB0C,MAAtB,GAA+B,YAAY;AACvC,QAAIP,KAAK,GAAG,IAAZ;;AACA,QAAIkG,KAAK,GAAG,KAAKvE,YAAL,EAAZ;;AACA,QAAIhB,IAAI,GAAG,KAAKF,OAAL,EAAX;AACA,QAAIiE,KAAK,GAAG;AAAE5C,MAAAA,CAAC,EAAE,CAAL;AAAQC,MAAAA,CAAC,EAAE;AAAX,KAAZ;;AACA,QAAIpB,IAAI,IAAIA,IAAI,CAAC8D,SAAL,EAAZ,EAA8B;AAC1BC,MAAAA,KAAK,GAAG/D,IAAI,CAAC8D,SAAL,GAAiBE,gBAAjB,EAAR;AACH;;AACD,QAAI2F,aAAa,GAAG;AAChBxI,MAAAA,CAAC,EAAE,IAAI4C,KAAK,CAAC5C,CADG;AAEhBC,MAAAA,CAAC,EAAE,IAAI2C,KAAK,CAAC3C;AAFG,KAApB;AAIA,QAAIC,KAAK,GAAGkE,KAAK,CAAClE,KAAlB;AACA,QAAIC,MAAM,GAAGiE,KAAK,CAACjE,MAAnB;AACA,QAAIsI,cAAc,GAAG,KAAKA,cAAL,EAArB;AACA,QAAIC,aAAa,GAAG,KAAKA,aAAL,EAApB;AACA,QAAIjF,OAAO,GAAG,KAAKA,OAAL,EAAd;AACA,QAAIkF,UAAU,GAAG,KAAKA,UAAL,EAAjB;AACA,SAAKC,IAAL,CAAU,UAAV,EAAsBC,IAAtB,CAA2B,UAAUhK,IAAV,EAAgB;AACvC,aAAOA,IAAI,CAACuJ,QAAL,CAAc;AACjBlI,QAAAA,KAAK,EAAEyI,UADU;AAEjBxI,QAAAA,MAAM,EAAEwI,UAFS;AAGjB5H,QAAAA,OAAO,EAAE4H,UAAU,GAAG,CAHL;AAIjBzH,QAAAA,OAAO,EAAEyH,UAAU,GAAG,CAJL;AAKjB1G,QAAAA,MAAM,EAAE/D,KAAK,CAAC4K,YAAN,EALS;AAMjB3G,QAAAA,WAAW,EAAEjE,KAAK,CAAC6K,iBAAN,EANI;AAOjB7G,QAAAA,IAAI,EAAEhE,KAAK,CAAC8K,UAAN,EAPW;AAQjBC,QAAAA,YAAY,EAAE/K,KAAK,CAACgL,kBAAN;AARG,OAAd,CAAP;AAUH,KAXD;AAYA,SAAK1J,OAAL,CAAa,WAAb,EAA0B4I,QAA1B,CAAmC;AAC/BpI,MAAAA,CAAC,EAAE,CAACyD,OAD2B;AAE/BxD,MAAAA,CAAC,EAAE,CAACwD,OAF2B;AAG/Bb,MAAAA,KAAK,EAAE4F,aAHwB;AAI/BW,MAAAA,OAAO,EAAET,aAAa,IAAID,cAAc,CAACW,OAAf,CAAuB,UAAvB,KAAsC;AAJjC,KAAnC;AAMA,SAAK5J,OAAL,CAAa,aAAb,EAA4B4I,QAA5B,CAAqC;AACjCpI,MAAAA,CAAC,EAAEE,KAAK,GAAG,CADsB;AAEjCD,MAAAA,CAAC,EAAE,CAACwD,OAF6B;AAGjCb,MAAAA,KAAK,EAAE4F,aAH0B;AAIjCW,MAAAA,OAAO,EAAET,aAAa,IAAID,cAAc,CAACW,OAAf,CAAuB,YAAvB,KAAwC;AAJjC,KAArC;AAMA,SAAK5J,OAAL,CAAa,YAAb,EAA2B4I,QAA3B,CAAoC;AAChCpI,MAAAA,CAAC,EAAEE,KAAK,GAAGuD,OADqB;AAEhCxD,MAAAA,CAAC,EAAE,CAACwD,OAF4B;AAGhCb,MAAAA,KAAK,EAAE4F,aAHyB;AAIhCW,MAAAA,OAAO,EAAET,aAAa,IAAID,cAAc,CAACW,OAAf,CAAuB,WAAvB,KAAuC;AAJjC,KAApC;AAMA,SAAK5J,OAAL,CAAa,cAAb,EAA6B4I,QAA7B,CAAsC;AAClCpI,MAAAA,CAAC,EAAE,CAACyD,OAD8B;AAElCxD,MAAAA,CAAC,EAAEE,MAAM,GAAG,CAFsB;AAGlCyC,MAAAA,KAAK,EAAE4F,aAH2B;AAIlCW,MAAAA,OAAO,EAAET,aAAa,IAAID,cAAc,CAACW,OAAf,CAAuB,aAAvB,KAAyC;AAJjC,KAAtC;AAMA,SAAK5J,OAAL,CAAa,eAAb,EAA8B4I,QAA9B,CAAuC;AACnCpI,MAAAA,CAAC,EAAEE,KAAK,GAAGuD,OADwB;AAEnCxD,MAAAA,CAAC,EAAEE,MAAM,GAAG,CAFuB;AAGnCyC,MAAAA,KAAK,EAAE4F,aAH4B;AAInCW,MAAAA,OAAO,EAAET,aAAa,IAAID,cAAc,CAACW,OAAf,CAAuB,cAAvB,KAA0C;AAJjC,KAAvC;AAMA,SAAK5J,OAAL,CAAa,cAAb,EAA6B4I,QAA7B,CAAsC;AAClCpI,MAAAA,CAAC,EAAE,CAACyD,OAD8B;AAElCxD,MAAAA,CAAC,EAAEE,MAAM,GAAGsD,OAFsB;AAGlCb,MAAAA,KAAK,EAAE4F,aAH2B;AAIlCW,MAAAA,OAAO,EAAET,aAAa,IAAID,cAAc,CAACW,OAAf,CAAuB,aAAvB,KAAyC;AAJjC,KAAtC;AAMA,SAAK5J,OAAL,CAAa,gBAAb,EAA+B4I,QAA/B,CAAwC;AACpCpI,MAAAA,CAAC,EAAEE,KAAK,GAAG,CADyB;AAEpCD,MAAAA,CAAC,EAAEE,MAAM,GAAGsD,OAFwB;AAGpCb,MAAAA,KAAK,EAAE4F,aAH6B;AAIpCW,MAAAA,OAAO,EAAET,aAAa,IAAID,cAAc,CAACW,OAAf,CAAuB,eAAvB,KAA2C;AAJjC,KAAxC;AAMA,SAAK5J,OAAL,CAAa,eAAb,EAA8B4I,QAA9B,CAAuC;AACnCpI,MAAAA,CAAC,EAAEE,KAAK,GAAGuD,OADwB;AAEnCxD,MAAAA,CAAC,EAAEE,MAAM,GAAGsD,OAFuB;AAGnCb,MAAAA,KAAK,EAAE4F,aAH4B;AAInCW,MAAAA,OAAO,EAAET,aAAa,IAAID,cAAc,CAACW,OAAf,CAAuB,cAAvB,KAA0C;AAJjC,KAAvC;AAMA,QAAIC,wBAAwB,GAAG,CAAC,KAAKvF,kBAAL,EAAD,GAA6B3C,IAAI,CAAC0F,GAAL,CAAS2B,aAAa,CAACvI,CAAvB,CAA5D;AACA,SAAKT,OAAL,CAAa,UAAb,EAAyB4I,QAAzB,CAAkC;AAC9BpI,MAAAA,CAAC,EAAEE,KAAK,GAAG,CADmB;AAE9BD,MAAAA,CAAC,EAAEoJ,wBAAwB,GAAGjN,MAAM,CAACmB,IAAP,CAAYwG,KAAZ,CAAkB5D,MAAlB,CAFA;AAG9ByC,MAAAA,KAAK,EAAE4F,aAHuB;AAI9BW,MAAAA,OAAO,EAAE,KAAKvF,aAAL;AAJqB,KAAlC;AAMA,SAAKpE,OAAL,CAAa,OAAb,EAAsB4I,QAAtB,CAA+B;AAC3BlI,MAAAA,KAAK,EAAEA,KAAK,GAAG0C,KAAK,CAAC5C,CADM;AAE3BG,MAAAA,MAAM,EAAEA,MAAM,GAAGyC,KAAK,CAAC3C,CAFI;AAG3B2C,MAAAA,KAAK,EAAE4F,aAHoB;AAI3BW,MAAAA,OAAO,EAAE,KAAKG,aAAL,EAJkB;AAK3BrH,MAAAA,MAAM,EAAE,KAAKsH,YAAL,EALmB;AAM3BpH,MAAAA,WAAW,EAAE,KAAKqH,iBAAL,EANc;AAO3BC,MAAAA,IAAI,EAAE,KAAKC,UAAL;AAPqB,KAA/B;AASH,GA9FD;;AA+FA3L,EAAAA,WAAW,CAAChC,SAAZ,CAAsB4N,cAAtB,GAAuC,YAAY;AAC/C,WAAO,KAAKvL,aAAZ;AACH,GAFD;;AAGAL,EAAAA,WAAW,CAAChC,SAAZ,CAAsB6N,aAAtB,GAAsC,YAAY;AAC9C,QAAI,KAAKxL,aAAT,EAAwB;AACpB,WAAKyJ,aAAL;;AACA,UAAIhD,WAAW,GAAG,KAAKrF,OAAL,CAAa,MAAM,KAAKyE,aAAxB,CAAlB;;AACA,UAAIY,WAAJ,EAAiB;AACbA,QAAAA,WAAW,CAACgF,QAAZ;AACH;AACJ;AACJ,GARD;;AASA9L,EAAAA,WAAW,CAAChC,SAAZ,CAAsB+N,OAAtB,GAAgC,YAAY;AACxC,QAAI,KAAK/G,QAAL,MAAmB,KAAKG,aAA5B,EAA2C;AACvC,WAAKH,QAAL,GAAgBC,OAAhB,CAAwBC,KAAxB,CAA8BH,MAA9B,GAAuC,EAAvC;AACH;;AACDpG,IAAAA,OAAO,CAACqN,KAAR,CAAchO,SAAd,CAAwB+N,OAAxB,CAAgC3L,IAAhC,CAAqC,IAArC;AACA,SAAKa,MAAL;;AACA,SAAK6I,aAAL;;AACA,WAAO,IAAP;AACH,GARD;;AASA9J,EAAAA,WAAW,CAAChC,SAAZ,CAAsBiO,QAAtB,GAAiC,YAAY;AACzC,WAAOzN,MAAM,CAAC0N,IAAP,CAAYlO,SAAZ,CAAsBiO,QAAtB,CAA+B7L,IAA/B,CAAoC,IAApC,CAAP;AACH,GAFD;;AAGA,SAAOJ,WAAP;AACH,CApgBkB,CAogBjBrB,OAAO,CAACqN,KApgBS,CAAnB;;AAqgBA7N,OAAO,CAAC6B,WAAR,GAAsBA,WAAtB;;AACA,SAASmM,eAAT,CAAyBC,GAAzB,EAA8B;AAC1B,MAAI,EAAEA,GAAG,YAAYzO,KAAjB,CAAJ,EAA6B;AACzBU,IAAAA,MAAM,CAACmB,IAAP,CAAY6M,IAAZ,CAAiB,yCAAjB;AACH;;AACD,MAAID,GAAG,YAAYzO,KAAnB,EAA0B;AACtByO,IAAAA,GAAG,CAACvI,OAAJ,CAAY,UAAUC,IAAV,EAAgB;AACxB,UAAIhE,aAAa,CAACuL,OAAd,CAAsBvH,IAAtB,MAAgC,CAAC,CAArC,EAAwC;AACpCzF,QAAAA,MAAM,CAACmB,IAAP,CAAY6M,IAAZ,CAAiB,0BACbvI,IADa,GAEb,yBAFa,GAGbhE,aAAa,CAACd,IAAd,CAAmB,IAAnB,CAHJ;AAIH;AACJ,KAPD;AAQH;;AACD,SAAOoN,GAAG,IAAI,EAAd;AACH;;AACDpM,WAAW,CAAChC,SAAZ,CAAsBsO,SAAtB,GAAkC,aAAlC;;AACAxN,QAAQ,CAACyN,aAAT,CAAuBvM,WAAvB;;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,gBAA/C,EAAiEF,aAAjE,EAAgFqM,eAAhF;AACA5N,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,eAA/C,EAAgE,IAAhE;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,YAA/C,EAA6D,EAA7D,EAAiEnB,YAAY,CAAC6N,kBAAb,EAAjE;AACAnO,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,eAA/C,EAAgE,IAAhE;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,eAA/C,EAAgE,EAAhE;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,oBAA/C,EAAqE,EAArE,EAAyEnB,YAAY,CAAC6N,kBAAb,EAAzE;AACAnO,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,eAA/C,EAAgE,IAAhE;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,cAA/C,EAA+D,kBAA/D;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,mBAA/C,EAAoE,CAApE,EAAuEnB,YAAY,CAAC6N,kBAAb,EAAvE;AACAnO,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,YAA/C,EAA6D,OAA7D;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,oBAA/C,EAAqE,CAArE,EAAwEnB,YAAY,CAAC6N,kBAAb,EAAxE;AACAnO,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,cAA/C,EAA+D,kBAA/D;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,mBAA/C,EAAoE,CAApE,EAAuEnB,YAAY,CAAC6N,kBAAb,EAAvE;AACAnO,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,YAA/C;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,WAA/C,EAA4D,IAA5D;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,iBAA/C,EAAkE,KAAlE;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,cAA/C,EAA+D,KAA/D;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,SAA/C,EAA0D,CAA1D,EAA6DnB,YAAY,CAAC6N,kBAAb,EAA7D;AACAnO,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,MAA/C;AACAzB,SAAS,CAACiO,OAAV,CAAkBC,eAAlB,CAAkCzM,WAAlC,EAA+C,cAA/C;AACAzB,SAAS,CAACiO,OAAV,CAAkBG,UAAlB,CAA6B3M,WAA7B,EAA0C;AACtC4M,EAAAA,WAAW,EAAE,eADyB;AAEtCC,EAAAA,mBAAmB,EAAE,oBAFiB;AAGtCC,EAAAA,eAAe,EAAE;AAHqB,CAA1C;AAKAzO,MAAM,CAAC0O,UAAP,CAAkBC,UAAlB,CAA6BhN,WAA7B","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Shape_1 = require(\"../Shape\");\nvar Rect_1 = require(\"./Rect\");\nvar Group_1 = require(\"../Group\");\nvar Global_1 = require(\"../Global\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_2 = require(\"../Global\");\nvar ATTR_CHANGE_LIST = [\n    'resizeEnabledChange',\n    'rotateAnchorOffsetChange',\n    'rotateEnabledChange',\n    'enabledAnchorsChange',\n    'anchorSizeChange',\n    'borderEnabledChange',\n    'borderStrokeChange',\n    'borderStrokeWidthChange',\n    'borderDashChange',\n    'anchorStrokeChange',\n    'anchorStrokeWidthChange',\n    'anchorFillChange',\n    'anchorCornerRadiusChange',\n    'ignoreStrokeChange'\n].join(' ');\nvar NODE_RECT = 'nodeRect';\nvar TRANSFORM_CHANGE_STR = [\n    'widthChange.tr',\n    'heightChange.tr',\n    'scaleXChange.tr',\n    'scaleYChange.tr',\n    'skewXChange.tr',\n    'skewYChange.tr',\n    'rotationChange.tr',\n    'offsetXChange.tr',\n    'offsetYChange.tr',\n    'transformsEnabledChange.tr',\n    'strokeWidthChange.tr'\n].join(' ');\nvar ANGLES = {\n    'top-left': -45,\n    'top-center': 0,\n    'top-right': 45,\n    'middle-right': -90,\n    'middle-left': 90,\n    'bottom-left': -135,\n    'bottom-center': 180,\n    'bottom-right': 135\n};\nfunction getCursor(anchorName, rad, isMirrored) {\n    if (anchorName === 'rotater') {\n        return 'crosshair';\n    }\n    rad += Util_1.Util._degToRad(ANGLES[anchorName] || 0);\n    if (isMirrored) {\n        rad *= -1;\n    }\n    var angle = ((Util_1.Util._radToDeg(rad) % 360) + 360) % 360;\n    if (Util_1.Util._inRange(angle, 315 + 22.5, 360) || Util_1.Util._inRange(angle, 0, 22.5)) {\n        return 'ns-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 45 - 22.5, 45 + 22.5)) {\n        return 'nesw-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 90 - 22.5, 90 + 22.5)) {\n        return 'ew-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 135 - 22.5, 135 + 22.5)) {\n        return 'nwse-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 180 - 22.5, 180 + 22.5)) {\n        return 'ns-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 225 - 22.5, 225 + 22.5)) {\n        return 'nesw-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 270 - 22.5, 270 + 22.5)) {\n        return 'ew-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 315 - 22.5, 315 + 22.5)) {\n        return 'nwse-resize';\n    }\n    else {\n        Util_1.Util.error('Transformer has unknown angle for cursor detection: ' + angle);\n        return 'pointer';\n    }\n}\nvar ANCHORS_NAMES = [\n    'top-left',\n    'top-center',\n    'top-right',\n    'middle-right',\n    'middle-left',\n    'bottom-left',\n    'bottom-center',\n    'bottom-right'\n];\nvar MAX_SAFE_INTEGER = 100000000;\nvar Transformer = (function (_super) {\n    __extends(Transformer, _super);\n    function Transformer(config) {\n        var _this = _super.call(this, config) || this;\n        _this._transforming = false;\n        _this._createElements();\n        _this._handleMouseMove = _this._handleMouseMove.bind(_this);\n        _this._handleMouseUp = _this._handleMouseUp.bind(_this);\n        _this.update = _this.update.bind(_this);\n        _this.on(ATTR_CHANGE_LIST, _this.update);\n        if (_this.getNode()) {\n            _this.update();\n        }\n        return _this;\n    }\n    Transformer.prototype.attachTo = function (node) {\n        this.setNode(node);\n        return this;\n    };\n    Transformer.prototype.setNode = function (node) {\n        var _this = this;\n        if (this._node) {\n            this.detach();\n        }\n        this._node = node;\n        this._resetTransformCache();\n        var additionalEvents = node._attrsAffectingSize\n            .map(function (prop) { return prop + 'Change.tr'; })\n            .join(' ');\n        var onChange = function () {\n            _this._resetTransformCache();\n            if (!_this._transforming) {\n                _this.update();\n            }\n        };\n        node.on(additionalEvents, onChange);\n        node.on(TRANSFORM_CHANGE_STR, onChange);\n        node.on('xChange.tr yChange.tr', function () { return _this._resetTransformCache(); });\n        var elementsCreated = !!this.findOne('.top-left');\n        if (elementsCreated) {\n            this.update();\n        }\n        return this;\n    };\n    Transformer.prototype.getNode = function () {\n        return this._node;\n    };\n    Transformer.prototype.detach = function () {\n        if (this.getNode()) {\n            this.getNode().off('.tr');\n            this._node = undefined;\n        }\n        this._resetTransformCache();\n    };\n    Transformer.prototype._resetTransformCache = function () {\n        this._clearCache(NODE_RECT);\n        this._clearCache('transform');\n        this._clearSelfAndDescendantCache('absoluteTransform');\n    };\n    Transformer.prototype._getNodeRect = function () {\n        return this._getCache(NODE_RECT, this.__getNodeRect);\n    };\n    Transformer.prototype.__getNodeRect = function () {\n        var node = this.getNode();\n        if (!node) {\n            return {\n                x: -MAX_SAFE_INTEGER,\n                y: -MAX_SAFE_INTEGER,\n                width: 0,\n                height: 0,\n                rotation: 0\n            };\n        }\n        var rect = node.getClientRect({\n            skipTransform: true,\n            skipShadow: true,\n            skipStroke: this.ignoreStroke()\n        });\n        var rotation = Global_1.Konva.getAngle(node.rotation());\n        var dx = rect.x * node.scaleX() - node.offsetX() * node.scaleX();\n        var dy = rect.y * node.scaleY() - node.offsetY() * node.scaleY();\n        return {\n            x: node.x() + dx * Math.cos(rotation) + dy * Math.sin(-rotation),\n            y: node.y() + dy * Math.cos(rotation) + dx * Math.sin(rotation),\n            width: rect.width * node.scaleX(),\n            height: rect.height * node.scaleY(),\n            rotation: node.rotation()\n        };\n    };\n    Transformer.prototype.getX = function () {\n        return this._getNodeRect().x;\n    };\n    Transformer.prototype.getY = function () {\n        return this._getNodeRect().y;\n    };\n    Transformer.prototype.getRotation = function () {\n        return this._getNodeRect().rotation;\n    };\n    Transformer.prototype.getWidth = function () {\n        return this._getNodeRect().width;\n    };\n    Transformer.prototype.getHeight = function () {\n        return this._getNodeRect().height;\n    };\n    Transformer.prototype._createElements = function () {\n        this._createBack();\n        ANCHORS_NAMES.forEach(function (name) {\n            this._createAnchor(name);\n        }.bind(this));\n        this._createAnchor('rotater');\n    };\n    Transformer.prototype._createAnchor = function (name) {\n        var anchor = new Rect_1.Rect({\n            stroke: 'rgb(0, 161, 255)',\n            fill: 'white',\n            strokeWidth: 1,\n            name: name + ' _anchor',\n            dragDistance: 0,\n            draggable: true\n        });\n        var self = this;\n        anchor.on('mousedown touchstart', function (e) {\n            self._handleMouseDown(e);\n        });\n        anchor.on('dragstart', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('dragmove', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('dragend', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('mouseenter', function () {\n            var tr = this.getParent();\n            var rad = Global_1.Konva.getAngle(tr.rotation());\n            var scale = tr.getNode().getAbsoluteScale();\n            var isMirrored = scale.y * scale.x < 0;\n            var cursor = getCursor(name, rad, isMirrored);\n            anchor.getStage().content.style.cursor = cursor;\n            tr._cursorChange = true;\n        });\n        anchor.on('mouseout', function () {\n            if (!anchor.getStage() || !this.getParent()) {\n                return;\n            }\n            anchor.getStage().content.style.cursor = '';\n            this.getParent()._cursorChange = false;\n        });\n        this.add(anchor);\n    };\n    Transformer.prototype._createBack = function () {\n        var back = new Shape_1.Shape({\n            name: 'back',\n            width: 0,\n            height: 0,\n            listening: false,\n            sceneFunc: function (ctx) {\n                var tr = this.getParent();\n                var padding = tr.padding();\n                ctx.beginPath();\n                ctx.rect(-padding, -padding, this.width() + padding * 2, this.height() + padding * 2);\n                ctx.moveTo(this.width() / 2, -padding);\n                if (tr.rotateEnabled()) {\n                    ctx.lineTo(this.width() / 2, -tr.rotateAnchorOffset() * Util_1.Util._sign(this.height()));\n                }\n                ctx.fillStrokeShape(this);\n            }\n        });\n        this.add(back);\n    };\n    Transformer.prototype._handleMouseDown = function (e) {\n        this.movingResizer = e.target.name().split(' ')[0];\n        var attrs = this._getNodeRect();\n        var width = attrs.width;\n        var height = attrs.height;\n        var hypotenuse = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2));\n        this.sin = height / hypotenuse;\n        this.cos = width / hypotenuse;\n        window.addEventListener('mousemove', this._handleMouseMove);\n        window.addEventListener('touchmove', this._handleMouseMove);\n        window.addEventListener('mouseup', this._handleMouseUp, true);\n        window.addEventListener('touchend', this._handleMouseUp, true);\n        this._transforming = true;\n        this._fire('transformstart', { evt: e });\n        this.getNode()._fire('transformstart', { evt: e });\n    };\n    Transformer.prototype._handleMouseMove = function (e) {\n        var x, y, newHypotenuse;\n        var resizerNode = this.findOne('.' + this.movingResizer);\n        var stage = resizerNode.getStage();\n        var box = stage.getContent().getBoundingClientRect();\n        var zeroPoint = {\n            x: box.left,\n            y: box.top\n        };\n        var pointerPos = {\n            left: e.clientX !== undefined ? e.clientX : e.touches[0].clientX,\n            top: e.clientX !== undefined ? e.clientY : e.touches[0].clientY\n        };\n        var newAbsPos = {\n            x: pointerPos.left - zeroPoint.x,\n            y: pointerPos.top - zeroPoint.y\n        };\n        resizerNode.setAbsolutePosition(newAbsPos);\n        var keepProportion = this.keepRatio() || e.shiftKey;\n        if (this.movingResizer === 'top-left') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x() - resizerNode.x(), 2) +\n                    Math.pow(this.findOne('.bottom-right').y() - resizerNode.y(), 2));\n                x = newHypotenuse * this.cos;\n                y = newHypotenuse * this.sin;\n                this.findOne('.top-left').x(this.findOne('.bottom-right').x() - x);\n                this.findOne('.top-left').y(this.findOne('.bottom-right').y() - y);\n            }\n        }\n        else if (this.movingResizer === 'top-center') {\n            this.findOne('.top-left').y(resizerNode.y());\n        }\n        else if (this.movingResizer === 'top-right') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-left').x() - resizerNode.x(), 2) +\n                    Math.pow(this.findOne('.bottom-left').y() - resizerNode.y(), 2));\n                x = newHypotenuse * this.cos;\n                y = newHypotenuse * this.sin;\n                this.findOne('.top-right').x(x);\n                this.findOne('.top-right').y(this.findOne('.bottom-left').y() - y);\n            }\n            var pos = resizerNode.position();\n            this.findOne('.top-left').y(pos.y);\n            this.findOne('.bottom-right').x(pos.x);\n        }\n        else if (this.movingResizer === 'middle-left') {\n            this.findOne('.top-left').x(resizerNode.x());\n        }\n        else if (this.movingResizer === 'middle-right') {\n            this.findOne('.bottom-right').x(resizerNode.x());\n        }\n        else if (this.movingResizer === 'bottom-left') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.top-right').x() - resizerNode.x(), 2) +\n                    Math.pow(this.findOne('.top-right').y() - resizerNode.y(), 2));\n                x = newHypotenuse * this.cos;\n                y = newHypotenuse * this.sin;\n                this.findOne('.bottom-left').x(this.findOne('.top-right').x() - x);\n                this.findOne('.bottom-left').y(y);\n            }\n            pos = resizerNode.position();\n            this.findOne('.top-left').x(pos.x);\n            this.findOne('.bottom-right').y(pos.y);\n        }\n        else if (this.movingResizer === 'bottom-center') {\n            this.findOne('.bottom-right').y(resizerNode.y());\n        }\n        else if (this.movingResizer === 'bottom-right') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x(), 2) +\n                    Math.pow(this.findOne('.bottom-right').y(), 2));\n                x = newHypotenuse * this.cos;\n                y = newHypotenuse * this.sin;\n                this.findOne('.bottom-right').x(x);\n                this.findOne('.bottom-right').y(y);\n            }\n        }\n        else if (this.movingResizer === 'rotater') {\n            var padding = this.padding();\n            var attrs = this._getNodeRect();\n            x = resizerNode.x() - attrs.width / 2;\n            y = -resizerNode.y() + attrs.height / 2;\n            var dAlpha = Math.atan2(-y, x) + Math.PI / 2;\n            if (attrs.height < 0) {\n                dAlpha -= Math.PI;\n            }\n            var rot = Global_1.Konva.getAngle(this.rotation());\n            var newRotation = Util_1.Util._radToDeg(rot) + Util_1.Util._radToDeg(dAlpha);\n            var alpha = Global_1.Konva.getAngle(this.getNode().rotation());\n            var newAlpha = Util_1.Util._degToRad(newRotation);\n            var snaps = this.rotationSnaps();\n            var offset = 0.1;\n            for (var i = 0; i < snaps.length; i++) {\n                var angle = Global_1.Konva.getAngle(snaps[i]);\n                var dif = Math.abs(angle - Util_1.Util._degToRad(newRotation)) % (Math.PI * 2);\n                if (dif < offset) {\n                    newRotation = Util_1.Util._radToDeg(angle);\n                    newAlpha = Util_1.Util._degToRad(newRotation);\n                }\n            }\n            var dx = padding;\n            var dy = padding;\n            this._fitNodeInto({\n                rotation: Global_1.Konva.angleDeg ? newRotation : Util_1.Util._degToRad(newRotation),\n                x: attrs.x +\n                    (attrs.width / 2 + padding) *\n                        (Math.cos(alpha) - Math.cos(newAlpha)) +\n                    (attrs.height / 2 + padding) *\n                        (Math.sin(-alpha) - Math.sin(-newAlpha)) -\n                    (dx * Math.cos(rot) + dy * Math.sin(-rot)),\n                y: attrs.y +\n                    (attrs.height / 2 + padding) *\n                        (Math.cos(alpha) - Math.cos(newAlpha)) +\n                    (attrs.width / 2 + padding) *\n                        (Math.sin(alpha) - Math.sin(newAlpha)) -\n                    (dy * Math.cos(rot) + dx * Math.sin(rot)),\n                width: attrs.width + padding * 2,\n                height: attrs.height + padding * 2\n            }, e);\n        }\n        else {\n            console.error(new Error('Wrong position argument of selection resizer: ' + this.movingResizer));\n        }\n        if (this.movingResizer === 'rotater') {\n            return;\n        }\n        var absPos = this.findOne('.top-left').getAbsolutePosition(this.getParent());\n        var centeredScaling = this.centeredScaling() || e.altKey;\n        if (centeredScaling) {\n            var topLeft = this.findOne('.top-left');\n            var bottomRight = this.findOne('.bottom-right');\n            var topOffsetX = topLeft.x();\n            var topOffsetY = topLeft.y();\n            var bottomOffsetX = this.getWidth() - bottomRight.x();\n            var bottomOffsetY = this.getHeight() - bottomRight.y();\n            bottomRight.move({\n                x: -topOffsetX,\n                y: -topOffsetY\n            });\n            topLeft.move({\n                x: bottomOffsetX,\n                y: bottomOffsetY\n            });\n            absPos = topLeft.getAbsolutePosition(this.getParent());\n        }\n        x = absPos.x;\n        y = absPos.y;\n        var width = this.findOne('.bottom-right').x() - this.findOne('.top-left').x();\n        var height = this.findOne('.bottom-right').y() - this.findOne('.top-left').y();\n        this._fitNodeInto({\n            x: x + this.offsetX(),\n            y: y + this.offsetY(),\n            width: width,\n            height: height\n        }, e);\n    };\n    Transformer.prototype._handleMouseUp = function (e) {\n        this._removeEvents(e);\n    };\n    Transformer.prototype._removeEvents = function (e) {\n        if (this._transforming) {\n            this._transforming = false;\n            window.removeEventListener('mousemove', this._handleMouseMove);\n            window.removeEventListener('touchmove', this._handleMouseMove);\n            window.removeEventListener('mouseup', this._handleMouseUp, true);\n            window.removeEventListener('touchend', this._handleMouseUp, true);\n            this._fire('transformend', { evt: e });\n            var node = this.getNode();\n            if (node) {\n                node.fire('transformend', { evt: e });\n            }\n        }\n    };\n    Transformer.prototype._fitNodeInto = function (newAttrs, evt) {\n        var boundBoxFunc = this.boundBoxFunc();\n        if (boundBoxFunc) {\n            var oldAttrs = this._getNodeRect();\n            newAttrs = boundBoxFunc.call(this, oldAttrs, newAttrs);\n        }\n        var node = this.getNode();\n        if (newAttrs.rotation !== undefined) {\n            this.getNode().rotation(newAttrs.rotation);\n        }\n        var pure = node.getClientRect({\n            skipTransform: true,\n            skipShadow: true,\n            skipStroke: this.ignoreStroke()\n        });\n        var padding = this.padding();\n        var scaleX = (newAttrs.width - padding * 2) / pure.width;\n        var scaleY = (newAttrs.height - padding * 2) / pure.height;\n        var rotation = Global_1.Konva.getAngle(node.rotation());\n        var dx = pure.x * scaleX - padding - node.offsetX() * scaleX;\n        var dy = pure.y * scaleY - padding - node.offsetY() * scaleY;\n        this.getNode().setAttrs({\n            scaleX: scaleX,\n            scaleY: scaleY,\n            x: newAttrs.x - (dx * Math.cos(rotation) + dy * Math.sin(-rotation)),\n            y: newAttrs.y - (dy * Math.cos(rotation) + dx * Math.sin(rotation))\n        });\n        this._fire('transform', { evt: evt });\n        this.getNode()._fire('transform', { evt: evt });\n        this.update();\n        this.getLayer().batchDraw();\n    };\n    Transformer.prototype.forceUpdate = function () {\n        this._resetTransformCache();\n        this.update();\n    };\n    Transformer.prototype.update = function () {\n        var _this = this;\n        var attrs = this._getNodeRect();\n        var node = this.getNode();\n        var scale = { x: 1, y: 1 };\n        if (node && node.getParent()) {\n            scale = node.getParent().getAbsoluteScale();\n        }\n        var invertedScale = {\n            x: 1 / scale.x,\n            y: 1 / scale.y\n        };\n        var width = attrs.width;\n        var height = attrs.height;\n        var enabledAnchors = this.enabledAnchors();\n        var resizeEnabled = this.resizeEnabled();\n        var padding = this.padding();\n        var anchorSize = this.anchorSize();\n        this.find('._anchor').each(function (node) {\n            return node.setAttrs({\n                width: anchorSize,\n                height: anchorSize,\n                offsetX: anchorSize / 2,\n                offsetY: anchorSize / 2,\n                stroke: _this.anchorStroke(),\n                strokeWidth: _this.anchorStrokeWidth(),\n                fill: _this.anchorFill(),\n                cornerRadius: _this.anchorCornerRadius()\n            });\n        });\n        this.findOne('.top-left').setAttrs({\n            x: -padding,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-left') >= 0\n        });\n        this.findOne('.top-center').setAttrs({\n            x: width / 2,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-center') >= 0\n        });\n        this.findOne('.top-right').setAttrs({\n            x: width + padding,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-right') >= 0\n        });\n        this.findOne('.middle-left').setAttrs({\n            x: -padding,\n            y: height / 2,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('middle-left') >= 0\n        });\n        this.findOne('.middle-right').setAttrs({\n            x: width + padding,\n            y: height / 2,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('middle-right') >= 0\n        });\n        this.findOne('.bottom-left').setAttrs({\n            x: -padding,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-left') >= 0\n        });\n        this.findOne('.bottom-center').setAttrs({\n            x: width / 2,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-center') >= 0\n        });\n        this.findOne('.bottom-right').setAttrs({\n            x: width + padding,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-right') >= 0\n        });\n        var scaledRotateAnchorOffset = -this.rotateAnchorOffset() * Math.abs(invertedScale.y);\n        this.findOne('.rotater').setAttrs({\n            x: width / 2,\n            y: scaledRotateAnchorOffset * Util_1.Util._sign(height),\n            scale: invertedScale,\n            visible: this.rotateEnabled()\n        });\n        this.findOne('.back').setAttrs({\n            width: width * scale.x,\n            height: height * scale.y,\n            scale: invertedScale,\n            visible: this.borderEnabled(),\n            stroke: this.borderStroke(),\n            strokeWidth: this.borderStrokeWidth(),\n            dash: this.borderDash()\n        });\n    };\n    Transformer.prototype.isTransforming = function () {\n        return this._transforming;\n    };\n    Transformer.prototype.stopTransform = function () {\n        if (this._transforming) {\n            this._removeEvents();\n            var resizerNode = this.findOne('.' + this.movingResizer);\n            if (resizerNode) {\n                resizerNode.stopDrag();\n            }\n        }\n    };\n    Transformer.prototype.destroy = function () {\n        if (this.getStage() && this._cursorChange) {\n            this.getStage().content.style.cursor = '';\n        }\n        Group_1.Group.prototype.destroy.call(this);\n        this.detach();\n        this._removeEvents();\n        return this;\n    };\n    Transformer.prototype.toObject = function () {\n        return Node_1.Node.prototype.toObject.call(this);\n    };\n    return Transformer;\n}(Group_1.Group));\nexports.Transformer = Transformer;\nfunction validateAnchors(val) {\n    if (!(val instanceof Array)) {\n        Util_1.Util.warn('enabledAnchors value should be an array');\n    }\n    if (val instanceof Array) {\n        val.forEach(function (name) {\n            if (ANCHORS_NAMES.indexOf(name) === -1) {\n                Util_1.Util.warn('Unknown anchor name: ' +\n                    name +\n                    '. Available names are: ' +\n                    ANCHORS_NAMES.join(', '));\n            }\n        });\n    }\n    return val || [];\n}\nTransformer.prototype.className = 'Transformer';\nGlobal_2._registerNode(Transformer);\nFactory_1.Factory.addGetterSetter(Transformer, 'enabledAnchors', ANCHORS_NAMES, validateAnchors);\nFactory_1.Factory.addGetterSetter(Transformer, 'resizeEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorSize', 10, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotationSnaps', []);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateAnchorOffset', 50, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorFill', 'white');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorCornerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderDash');\nFactory_1.Factory.addGetterSetter(Transformer, 'keepRatio', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'centeredScaling', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'ignoreStroke', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'padding', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'node');\nFactory_1.Factory.addGetterSetter(Transformer, 'boundBoxFunc');\nFactory_1.Factory.backCompat(Transformer, {\n    lineEnabled: 'borderEnabled',\n    rotateHandlerOffset: 'rotateAnchorOffset',\n    enabledHandlers: 'enabledAnchors'\n});\nUtil_1.Collection.mapMethods(Transformer);\n"]},"metadata":{},"sourceType":"script"}