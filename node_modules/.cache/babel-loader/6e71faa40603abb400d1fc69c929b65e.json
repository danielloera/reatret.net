{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import React,{Component}from'react';import{secondaryColor}from'../App/App';import{withStyles}from'@material-ui/core/styles';import{Stage,FastLayer,Rect,Circle,RegularPolygon}from'react-konva';import{HuePicker}from'react-color';import Snackbar from'@material-ui/core/Snackbar';import Select from'@material-ui/core/Select';import InputLabel from'@material-ui/core/InputLabel';import MenuItem from'@material-ui/core/MenuItem';import Card from'@material-ui/core/Card';import CardContent from'@material-ui/core/CardContent';import FormControl from'@material-ui/core/FormControl';import Typography from'@material-ui/core/Typography';import threads from'threads';import Slider from'rc-slider';import'rc-slider/assets/index.css';const TSlider=Slider.createSliderWithTooltip(Slider);const SCREEN_PERCENTAGE=0.80;const CALC_PRIMES=\"Calculating Primes...\";const RENDER=\"Rendering...\";const CIRCLE=0;const SQUARE=1;const TRIANGLE=2;function getSpiralIdx(n){const k=Math.ceil((Math.sqrt(n)-1)/2);let t=2*k+1;let m=Math.pow(t,2);t-=1;if(n>=m-t){return{x:k-(m-n),y:k};}else{m-=t;}if(n>=m-t){return{x:-k,y:k-(m-n)};}else{m-=t;}if(n>=m-t){return{x:-k+(m-n),y:-k};}return{x:k,y:-k+(m-n-t)};}function spiralize(board,num){const size=Math.pow(board.length,2);const len=board.length;const rawHalf=len/2;const half=len%2===0?Math.ceil(rawHalf)-1:Math.floor(rawHalf);for(let i=1;i<=size;i++){const idx=getSpiralIdx(i);board[idx.x+half][idx.y+half]=num;num+=1;}}const SLIDER_FIELDS=[{name:\"Grid\\xa0Size\\xa0(NxN)\",id:\"primeSize\",min:5,max:1001},{name:\"Shape\\xa0Size\",id:\"shapeSize\",min:1,max:100},{name:\"Starting\\xa0Number\",id:\"start\",min:1,max:500}];function createSliders(fields,values,classes,fn){const doms=[];for(let i=0;i<fields.length;i++){const field=fields[i];const value=values[i];doms.push(/*#__PURE__*/_jsxs(\"div\",{className:classes.sliderField,id:field.name,children:[/*#__PURE__*/_jsx(Typography,{align:\"left\",className:classes.slideLabel,color:\"textSecondary\",children:\"\".concat(field.name,\":\\xA0\").concat(value)}),/*#__PURE__*/_jsx(TSlider,{handleStyle:{backgroundColor:secondaryColor,borderColor:secondaryColor},trackStyle:{backgroundColor:secondaryColor,borderColor:secondaryColor},className:classes.slider,min:field.min,max:field.max,step:1,defaultValue:value,onAfterChange:fn(field.id)})]},field.name));}return doms;}class PrimeUlam extends Component{constructor(props){super(props);const start=1;const primeSize=101;this.board=null;this.prevPrimes=null;this.backgroundRect=null;this.maxPrimeSize=primeSize;this.maxStart=start;this.state={spiral:null,bgColor:\"white\",color:\"black\",shape:CIRCLE,shapeSize:5,start:start,stageSize:0,primeSize:primeSize,primes:null,notify:false,msg:''};this.layer=null;this.handleSlider=this.handleSlider.bind(this);this.makeSpiral=this.makeSpiral.bind(this);this.updateDimensions=this.updateDimensions.bind(this);}notify(msg,then){this.setState({msg:msg,notify:true},then);}updateDimensions(){this.setState({stageSize:Math.trunc(Math.min(window.innerWidth,window.innerHeight)*SCREEN_PERCENTAGE)},this.makeSpiral);}componentDidMount(){const _this$state=this.state,primeSize=_this$state.primeSize,start=_this$state.start;this.updatePrimes(Math.pow(primeSize+start,2));this.updateDimensions();window.addEventListener(\"resize\",this.updateDimensions);}componentDidUpdate(prevProps,prevState){const _this$state2=this.state,primeSize=_this$state2.primeSize,start=_this$state2.start,shapeSize=_this$state2.shapeSize;if(primeSize!==prevState.primeSize){if(this.maxPrimeSize<primeSize){this.maxPrimeSize=primeSize;const limit=Math.pow(primeSize+start,2);this.updatePrimes(limit);}else{this.notify(RENDER,this.makeSpiral);}}if(start&&start!==prevState.start){const newLimit=Math.pow(this.maxPrimeSize+start,2);const oldLimit=Math.pow(this.maxPrimeSize+this.maxStart,2);if(oldLimit<newLimit){this.maxStart=start;this.updatePrimes(newLimit);}else{this.notify(RENDER,ns=>{this.makeSpiral(false,true);});}}if(shapeSize!==prevState.shapeSize){this.notify(RENDER,this.makeSpiral);}}updatePrimes(limit){const primeThread=threads.spawn((input,done)=>{const ps=function primesSieve(limit,prevData){let a=null;let start=0;if(prevData&&prevData.length<limit){a=prevData;const prevLen=prevData.length;start=prevLen;// Limit MUST be greater then prev data len\nconst diff=limit-prevLen;for(let i=0;i<diff;i++){a.push(true);}}else{a=Array(limit);a[0]=false;a[1]=false;a.fill(true,2,limit);}const ans=new Set([]);for(let i=start;i<a.length;i++){const isPrime=a[i];if(isPrime){ans.add(i);for(let n=i*i;n<limit;n+=i){a[n]=false;}}}return{primes:ans,prevData:a};};done({ps:ps(input.limit,input.prevPrimes)});});this.notify(CALC_PRIMES);primeThread.send({limit:limit,prevPrimes:this.prevPrimes}).on('message',response=>{this.prevPrimes=response.ps.data;this.setState({primes:response.ps.primes},ns=>{this.makeSpiral(true);});});}makeSpiral(newBoard,newStart=false){const _this$state3=this.state,start=_this$state3.start,primeSize=_this$state3.primeSize,stageSize=_this$state3.stageSize,shapeSize=_this$state3.shapeSize,color=_this$state3.color,primes=_this$state3.primes;if(!stageSize||!primeSize||!start||!shapeSize||!primes){return null;}const primeJump=Math.ceil(stageSize/primeSize);if(newBoard){this.board=[];for(let i=0;i<primeSize;i++){const tempArr=Array(primeSize);this.board.push(tempArr);}}if(newBoard||newStart){spiralize(this.board,start);}const circles=[];const squares=[];const triangs=[];for(let x=0;x<primeSize;x++){for(let y=0;y<primeSize;y++){if(primes.has(this.board[x][y])){const jx=x*primeJump;const jy=y*primeJump;const key=\"\".concat(x,\" \").concat(y);circles.push(/*#__PURE__*/_jsx(Circle,{x:jx,y:jy,radius:shapeSize,fill:color,listening:false,perfectDrawEnabled:false},key));squares.push(/*#__PURE__*/_jsx(Rect,{x:jx,y:jy,width:shapeSize,height:shapeSize,fill:color,listening:false,perfectDrawEnabled:false},key));triangs.push(/*#__PURE__*/_jsx(RegularPolygon,{x:jx,y:jy,sides:3,radius:shapeSize,fill:color,listening:false,perfectDrawEnabled:false},key));}}}this.setState({spiral:{[CIRCLE]:circles,[SQUARE]:squares,[TRIANGLE]:triangs}});}handleSlider(id){return val=>{this.setState({[id]:val});};}render(){const classes=this.props.classes;const _this$state4=this.state,stageSize=_this$state4.stageSize,primeSize=_this$state4.primeSize,shapeSize=_this$state4.shapeSize,start=_this$state4.start,notify=_this$state4.notify,msg=_this$state4.msg,spiral=_this$state4.spiral,color=_this$state4.color,bgColor=_this$state4.bgColor,shape=_this$state4.shape;const numberVars=[primeSize,shapeSize,start];const shapes=spiral?spiral[shape]:[];if(this.layer)this.layer.batchDraw();return/*#__PURE__*/_jsxs(\"div\",{className:classes.title,children:[/*#__PURE__*/_jsx(Typography,{align:\"center\",variant:\"h5\",children:\" Ulam Spiral Generator\"}),/*#__PURE__*/_jsx(Snackbar,{anchorOrigin:{vertical:\"bottom\",horizontal:\"left\"},open:notify,autoHideDuration:2000,onClose:()=>{this.setState({notify:false});},ContentProps:{'aria-describedby':'message-id'},message:/*#__PURE__*/_jsx(\"span\",{id:\"message-id\",children:msg})}),/*#__PURE__*/_jsx(\"div\",{className:classes.root,children:/*#__PURE__*/_jsxs(Stage,{className:classes.stage,width:stageSize,height:stageSize,children:[/*#__PURE__*/_jsx(FastLayer,{children:/*#__PURE__*/_jsx(Rect,{x:0,y:0,width:stageSize,height:stageSize,fill:bgColor,shadowBlur:5})}),/*#__PURE__*/_jsxs(FastLayer,{ref:_ref=>this.layer=_ref,children:[/*#__PURE__*/_jsx(Rect,{x:0,y:0,width:stageSize,height:stageSize,fill:bgColor,shadowBlur:5}),shapes]})]})}),/*#__PURE__*/_jsx(\"div\",{className:classes.cardHolder,children:/*#__PURE__*/_jsx(Card,{className:classes.card,elevation:4,children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{className:classes.controlsLabel,variant:\"h6\",children:\"Controls\"}),/*#__PURE__*/_jsxs(\"form\",{className:classes.controls,noValidate:true,autoComplete:\"off\",children:[createSliders(SLIDER_FIELDS,numberVars,classes,this.handleSlider),/*#__PURE__*/_jsxs(\"div\",{className:classes.cPickers,children:[/*#__PURE__*/_jsxs(\"span\",{className:classes.colorPicker,children:[/*#__PURE__*/_jsx(Typography,{align:\"left\",color:\"textSecondary\",children:\"Background Color\"}),/*#__PURE__*/_jsx(HuePicker,{className:classes.colorPicker,color:bgColor,onChangeComplete:c=>{if(!c)return;this.setState({bgColor:c.hex});}})]}),/*#__PURE__*/_jsxs(\"span\",{className:classes.colorPicker,children:[/*#__PURE__*/_jsx(Typography,{align:\"left\",color:\"textSecondary\",children:\"Shape Color\"}),/*#__PURE__*/_jsx(HuePicker,{className:classes.colorPicker,color:color,onChangeComplete:c=>{if(!c)return;this.setState({color:c.hex},this.makeSpiral);}})]})]}),/*#__PURE__*/_jsxs(FormControl,{className:classes.shapePicker,children:[/*#__PURE__*/_jsx(InputLabel,{htmlFor:\"select\",children:\"Shape\"}),/*#__PURE__*/_jsxs(Select,{value:this.state.shape,onChange:event=>{this.setState({[event.target.name]:event.target.value});},inputProps:{name:'shape',id:'select'},children:[/*#__PURE__*/_jsx(MenuItem,{value:0,children:\"Circle\"}),/*#__PURE__*/_jsx(MenuItem,{value:1,children:\"Square\"}),/*#__PURE__*/_jsx(MenuItem,{value:2,children:\"Triangle\"})]})]})]})]})})}),/*#__PURE__*/_jsx(\"div\",{className:classes.endingText,children:/*#__PURE__*/_jsxs(Typography,{component:\"p\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Warning\"}),\": higher grid sizes may cause some slow down.\",/*#__PURE__*/_jsx(\"br\",{}),\"This project was inspired by\",\" \",/*#__PURE__*/_jsx(\"a\",{href:\"https://www.youtube.com/watch?v=iFuR97YcSLM\",children:\"this\"}),\" \",\" awesome numberphile video. You can read more about Prime Ulam Spirals\",\" \",/*#__PURE__*/_jsx(\"a\",{href:\"https://en.wikipedia.org/wiki/Ulam_spiral\",children:\"here.\"}),/*#__PURE__*/_jsx(\"br\",{}),\"You can also check out the\",\" \",/*#__PURE__*/_jsx(\"a\",{href:\"https://gitlab.com/danielloera/primeulam\",children:\"python version\"}),\" \",\"I made.\"]})})]});}}const styles=theme=>({title:{marginTop:'3vh',textAlign:'center',padding:theme.spacing(2)},root:{display:'flex',alignItems:'center',justifyContent:'center',textAlign:'center'},stage:{marginTop:'3vh'},card:{marginTop:'2rem',padding:'1rem',minWidth:'30vw',maxWidth:'90vw'},cardHolder:{justifyContent:'center',display:'flex',flexWrap:'wrap'},controlsLabel:{},controls:{display:'flex',flexWrap:'wrap',justifyContent:'center',marginLeft:theme.spacing(3),marginRight:theme.spacing(3)},sliderField:{width:'15ch',margin:theme.spacing(4)},colorPicker:{marginTop:theme.spacing(1),marginLeft:theme.spacing(2),marginRight:theme.spacing(4),maxWidth:'15rem'},cPickers:{display:'flex',marginTop:theme.spacing(3)},slideLabel:{marginBottom:theme.spacing(3)},shapePicker:{marginTop:theme.spacing(4)},endingText:{marginTop:theme.spacing(3),marginBottom:'25vh',padding:theme.spacing(2)}});export default withStyles(styles)(PrimeUlam);","map":{"version":3,"sources":["/home/daniel/reatret.net/src/components/PrimeUlam/PrimeUlam.js"],"names":["React","Component","secondaryColor","withStyles","Stage","FastLayer","Rect","Circle","RegularPolygon","HuePicker","Snackbar","Select","InputLabel","MenuItem","Card","CardContent","FormControl","Typography","threads","Slider","TSlider","createSliderWithTooltip","SCREEN_PERCENTAGE","CALC_PRIMES","RENDER","CIRCLE","SQUARE","TRIANGLE","getSpiralIdx","n","k","Math","ceil","sqrt","t","m","pow","x","y","spiralize","board","num","size","length","len","rawHalf","half","floor","i","idx","SLIDER_FIELDS","name","id","min","max","createSliders","fields","values","classes","fn","doms","field","value","push","sliderField","slideLabel","backgroundColor","borderColor","slider","PrimeUlam","constructor","props","start","primeSize","prevPrimes","backgroundRect","maxPrimeSize","maxStart","state","spiral","bgColor","color","shape","shapeSize","stageSize","primes","notify","msg","layer","handleSlider","bind","makeSpiral","updateDimensions","then","setState","trunc","window","innerWidth","innerHeight","componentDidMount","updatePrimes","addEventListener","componentDidUpdate","prevProps","prevState","limit","newLimit","oldLimit","ns","primeThread","spawn","input","done","ps","primesSieve","prevData","a","prevLen","diff","Array","fill","ans","Set","isPrime","add","send","on","response","data","newBoard","newStart","primeJump","tempArr","circles","squares","triangs","has","jx","jy","key","val","render","numberVars","shapes","batchDraw","title","vertical","horizontal","root","stage","ref","cardHolder","card","controlsLabel","controls","cPickers","colorPicker","c","hex","shapePicker","event","target","endingText","styles","theme","marginTop","textAlign","padding","spacing","display","alignItems","justifyContent","minWidth","maxWidth","flexWrap","marginLeft","marginRight","width","margin","marginBottom"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport { secondaryColor } from '../App/App'\nimport PropTypes from 'prop-types'\nimport { withStyles } from '@material-ui/core/styles'\nimport { Stage, FastLayer, Rect, Circle, RegularPolygon } from 'react-konva'\nimport { HuePicker } from 'react-color'\nimport Snackbar from '@material-ui/core/Snackbar'\nimport Select from '@material-ui/core/Select'\nimport InputLabel from '@material-ui/core/InputLabel'\nimport MenuItem from '@material-ui/core/MenuItem'\nimport Card from '@material-ui/core/Card'\nimport CardContent from '@material-ui/core/CardContent'\nimport FormControl from '@material-ui/core/FormControl'\nimport Typography from '@material-ui/core/Typography'\nimport threads from 'threads'\nimport Slider from 'rc-slider'\nimport 'rc-slider/assets/index.css'\nconst TSlider = Slider.createSliderWithTooltip(Slider)\n\nconst SCREEN_PERCENTAGE = 0.80\nconst CALC_PRIMES = \"Calculating Primes...\"\nconst RENDER = \"Rendering...\"\n\nconst CIRCLE = 0\nconst SQUARE = 1\nconst TRIANGLE = 2\n\nfunction getSpiralIdx(n) {\n  const k = Math.ceil((Math.sqrt(n) - 1) / 2)\n  let t = 2 * k + 1\n  let m = Math.pow(t, 2)\n  t -= 1\n  if (n >= m - t) {\n    return {x: k-(m-n), y: k}\n  } else {\n    m -= t\n  }\n  if (n >= m - t) {\n    return {x: -k, y: k - (m - n)}\n  } else {\n    m -= t\n  }\n  if (n >= m - t) {\n    return {x: -k + (m-n), y: -k}\n  }\n  return {x: k, y: -k+(m-n-t)}\n}\n\nfunction spiralize(board, num) {\n  const size = Math.pow(board.length, 2)\n  const len = board.length\n  const rawHalf = len / 2\n  const half = len % 2 === 0 ?\n              Math.ceil(rawHalf) - 1:\n              Math.floor(rawHalf)\n  for (let i = 1; i <= size; i++) {\n    const idx = getSpiralIdx(i)\n    board[idx.x + half][idx.y + half] = num\n    num += 1\n  }\n}\n\nconst SLIDER_FIELDS = [\n  {\n    name: \"Grid\\xa0Size\\xa0(NxN)\",\n    id: \"primeSize\",\n    min: 5,\n    max: 1001,\n  },\n  {\n    name: \"Shape\\xa0Size\",\n    id: \"shapeSize\",\n    min: 1,\n    max: 100,\n  },\n  {\n    name: \"Starting\\xa0Number\",\n    id: \"start\",\n    min: 1,\n    max: 500,\n  },\n]\n\nfunction createSliders(fields, values, classes, fn) {\n  const doms = []\n  for (let i = 0; i < fields.length; i++) {\n    const field = fields[i]\n    const value = values[i]\n    doms.push((\n      <div\n        className={classes.sliderField}\n        key={field.name}\n        id={field.name}>\n          <Typography align=\"left\" className={classes.slideLabel} color=\"textSecondary\">{`${field.name}:\\xa0${value}`}</Typography>\n          <TSlider\n            handleStyle={{backgroundColor: secondaryColor, borderColor: secondaryColor}}\n            trackStyle={{backgroundColor: secondaryColor, borderColor: secondaryColor}}\n            className={classes.slider}\n            min={field.min}\n            max={field.max}\n            step={1}\n            defaultValue={value}\n            onAfterChange={fn(field.id)}/>\n      </div>\n    ))\n  }\n  return doms\n}\n\nclass PrimeUlam extends Component {\n\n  constructor(props) {\n    super(props)\n    const start = 1\n    const primeSize = 101\n    this.board = null\n    this.prevPrimes = null\n    this.backgroundRect = null\n    this.maxPrimeSize = primeSize\n    this.maxStart = start\n    this.state = {\n      spiral: null,\n      bgColor: \"white\",\n      color: \"black\",\n      shape: CIRCLE,\n      shapeSize: 5,\n      start: start,\n      stageSize: 0,\n      primeSize: primeSize,\n      primes: null,\n      notify: false,\n      msg: '',\n    }\n    this.layer = null\n    this.handleSlider = this.handleSlider.bind(this)\n    this.makeSpiral = this.makeSpiral.bind(this)\n    this.updateDimensions = this.updateDimensions.bind(this)\n  }\n\n  notify(msg, then) {\n    this.setState({\n      msg: msg,\n      notify: true\n    }, then)\n  }\n\n  updateDimensions() {\n    this.setState({\n      stageSize: Math.trunc(Math.min(window.innerWidth, window.innerHeight) * SCREEN_PERCENTAGE)\n    }, this.makeSpiral)\n  }\n\n  componentDidMount() {\n    const {primeSize, start} = this.state\n    this.updatePrimes(Math.pow(primeSize + start, 2))\n    this.updateDimensions()\n    window.addEventListener(\"resize\", this.updateDimensions)\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    const {primeSize, start, shapeSize} = this.state\n    if (primeSize !== prevState.primeSize) {\n      if (this.maxPrimeSize < primeSize) {\n        this.maxPrimeSize = primeSize\n        const limit = Math.pow(primeSize + start, 2)\n        this.updatePrimes(limit)\n      } else {\n        this.notify(RENDER, this.makeSpiral)\n      }\n    }\n    if (start && start !== prevState.start) {\n      const newLimit = Math.pow(this.maxPrimeSize + start, 2)\n      const oldLimit = Math.pow(this.maxPrimeSize + this.maxStart, 2)\n      if (oldLimit < newLimit) {\n        this.maxStart = start\n        this.updatePrimes(newLimit)\n      } else {\n        this.notify(RENDER, (ns)=> {\n          this.makeSpiral(false, true)\n        })\n      }\n    }\n    if (shapeSize !== prevState.shapeSize) {\n      this.notify(RENDER, this.makeSpiral)\n    }\n  }\n\n  updatePrimes(limit) {\n    const primeThread = threads.spawn((input, done) => {\n      const ps = function primesSieve(limit, prevData) {\n        let a = null\n        let start = 0\n        if (prevData && prevData.length < limit) {\n          a = prevData\n          const prevLen = prevData.length\n          start = prevLen\n          // Limit MUST be greater then prev data len\n          const diff = limit - prevLen\n          for (let i = 0; i < diff; i++) {\n            a.push(true)\n          }\n        } else {\n          a = Array(limit)\n          a[0] = false\n          a[1] = false\n          a.fill(true, 2, limit)\n        }\n        const ans = new Set([])\n        for(let i = start; i < a.length; i++) {\n          const isPrime = a[i]\n          if (isPrime) {\n            ans.add(i)\n            for (let n = i*i; n < limit; n+=i) {\n              a[n] = false\n            }\n          }\n        }\n        return {primes: ans, prevData: a}\n      }\n      done({ps: ps(input.limit, input.prevPrimes)})\n    })\n    this.notify(CALC_PRIMES)\n    primeThread.send({limit: limit, prevPrimes: this.prevPrimes})\n    .on('message', (response) => {\n      this.prevPrimes = response.ps.data\n      this.setState({\n        primes: response.ps.primes\n      }, (ns)=>{ this.makeSpiral(true) })\n    })\n  }\n\n  makeSpiral(newBoard, newStart=false) {\n    const {start, primeSize, stageSize, shapeSize,\n           color, primes} = this.state\n    if (!stageSize || !primeSize || !start ||\n        !shapeSize || !primes) {\n      return null\n    }\n    const primeJump = Math.ceil(stageSize / primeSize)\n    if (newBoard) {\n      this.board = []\n      for (let i = 0; i < primeSize; i++) {\n        const tempArr = Array(primeSize)\n        this.board.push(tempArr)\n      }\n    }\n    if (newBoard || newStart) {\n      spiralize(this.board, start)\n    }\n    const circles = []\n    const squares = []\n    const triangs = []\n    for (let x = 0; x < primeSize; x++) {\n      for (let y = 0; y < primeSize; y++) {\n        if (primes.has(this.board[x][y])) {\n          const jx = x * primeJump\n          const jy = y * primeJump\n          const key = `${x} ${y}`\n          circles.push(<Circle\n                        key={key}\n                        x={jx} y={jy}\n                        radius={shapeSize}\n                        fill={color}\n                        listening={false}\n                        perfectDrawEnabled={false}/>)\n          squares.push(<Rect\n                        key={key}\n                        x={jx} y={jy}\n                        width={shapeSize} height={shapeSize}\n                        fill={color}\n                        listening={false}\n                        perfectDrawEnabled={false}/>)\n          triangs.push(<RegularPolygon\n                        key={key}\n                        x={jx} y={jy}\n                        sides={3} radius={shapeSize}\n                        fill={color}\n                        listening={false}\n                        perfectDrawEnabled={false}/>)\n        }\n      }\n    }\n    this.setState({\n        spiral: {\n          [CIRCLE]: circles,\n          [SQUARE]: squares,\n          [TRIANGLE]: triangs,\n        }\n      }\n    )\n  }\n\n  handleSlider(id){\n    return (val) => {\n      this.setState({[id]: val})\n    }\n  }\n\n  render() {\n    const {classes} = this.props\n    const {stageSize, primeSize, shapeSize,\n           start, notify, msg, spiral,\n           color, bgColor, shape} = this.state\n    const numberVars = [primeSize, shapeSize, start]\n    const shapes = spiral ? spiral[shape] : []\n    if (this.layer) this.layer.batchDraw()\n    return (\n      <div className={classes.title}>\n        <Typography align=\"center\" variant=\"h5\"> Ulam Spiral Generator</Typography>\n        <Snackbar\n          anchorOrigin={{vertical: \"bottom\", horizontal: \"left\"}}\n          open={notify}\n          autoHideDuration={2000}\n          onClose={()=> {this.setState({notify: false})}}\n          ContentProps={{\n            'aria-describedby': 'message-id',\n          }}\n          message={<span id=\"message-id\">{msg}</span>}/>\n        <div className={classes.root}>\n          <Stage className={classes.stage}\n                 width={stageSize}\n                 height={stageSize}>\n            <FastLayer>\n              <Rect x={0} y={0}\n                    width={stageSize} height={stageSize}\n                    fill={bgColor} shadowBlur={5}/>\n            </FastLayer>\n            <FastLayer ref={(ref)=> this.layer = ref}>\n              <Rect x={0} y={0}\n                    width={stageSize} height={stageSize}\n                    fill={bgColor} shadowBlur={5}/>\n              {shapes}\n            </FastLayer>\n          </Stage>\n        </div>\n        {/* Controls */}\n        <div className={classes.cardHolder}>\n        <Card className={classes.card} elevation={4}>\n          <CardContent>\n            <Typography className={classes.controlsLabel} variant=\"h6\">Controls</Typography>\n            <form className={classes.controls} noValidate autoComplete=\"off\">\n              {createSliders(SLIDER_FIELDS, numberVars, classes, this.handleSlider)}\n              <div className={classes.cPickers}>\n                <span className={classes.colorPicker}>\n                  <Typography align=\"left\" color=\"textSecondary\">Background Color</Typography>\n                  <HuePicker\n                    className={classes.colorPicker}\n                    color={bgColor}\n                    onChangeComplete={(c) => {\n                      if (!c) return\n                      this.setState({bgColor: c.hex})}\n                  }/>\n                </span>\n                <span className={classes.colorPicker}>\n                 <Typography align=\"left\" color=\"textSecondary\">Shape Color</Typography>\n                 <HuePicker\n                    className={classes.colorPicker}\n                    color={color}\n                    onChangeComplete={(c) => {\n                      if(!c) return\n                      this.setState({color: c.hex}, this.makeSpiral)\n                  }}/>\n                </span>\n              </div>\n            <FormControl className={classes.shapePicker}>\n              <InputLabel htmlFor=\"select\">Shape</InputLabel>\n              <Select\n                value={this.state.shape}\n                onChange={(event)=> {\n                    this.setState({[event.target.name]: event.target.value})\n                  }}\n                inputProps={{\n                  name: 'shape',\n                  id: 'select',\n                }}>\n                <MenuItem value={0}>Circle</MenuItem>\n                <MenuItem value={1}>Square</MenuItem>\n                <MenuItem value={2}>Triangle</MenuItem>\n              </Select>\n            </FormControl>\n            </form>\n          </CardContent>\n        </Card>\n        </div>\n        {/* Bottom Text */}\n        <div className={classes.endingText}>\n          <Typography component=\"p\" >\n            <b>Warning</b>: higher grid sizes may cause some slow down.<br/>\n            This project was inspired by{\" \"}\n            <a href=\"https://www.youtube.com/watch?v=iFuR97YcSLM\">this</a>\n            {\" \"} awesome numberphile video.\n            You can read more about Prime Ulam Spirals{\" \"}\n            <a href=\"https://en.wikipedia.org/wiki/Ulam_spiral\">here.</a><br/>\n            You can also check out the{\" \"}\n            <a href=\"https://gitlab.com/danielloera/primeulam\">python version</a>\n            {\" \"}I made.\n          </Typography>\n        </div>\n      </div>\n    )\n  }\n}\n\nconst styles = (theme) => ({\n  title: {\n    marginTop: '3vh',\n    textAlign: 'center',\n    padding: theme.spacing(2),\n  },\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    textAlign: 'center',\n  },\n  stage: {\n    marginTop: '3vh',\n  },\n  card: {\n    marginTop: '2rem',\n    padding: '1rem',\n    minWidth: '30vw',\n    maxWidth: '90vw',\n  },\n  cardHolder: {\n    justifyContent: 'center',\n    display: 'flex',\n    flexWrap: 'wrap',\n  },\n  controlsLabel: {\n  },\n  controls: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    justifyContent: 'center',\n    marginLeft: theme.spacing(3),\n    marginRight: theme.spacing(3),\n  },\n  sliderField: {\n    width: '15ch',\n    margin: theme.spacing(4),\n  },\n  colorPicker: {\n    marginTop: theme.spacing(1),\n    marginLeft: theme.spacing(2),\n    marginRight: theme.spacing(4),\n    maxWidth: '15rem',\n  },\n  cPickers: {\n    display: 'flex',\n    marginTop: theme.spacing(3),\n  },\n  slideLabel: {\n    marginBottom: theme.spacing(3)\n  },\n  shapePicker: {\n    marginTop: theme.spacing(4)\n  },\n  endingText: {\n    marginTop: theme.spacing(3),\n    marginBottom: '25vh',\n    padding: theme.spacing(2)\n  }\n})\n\nPrimeUlam.propTypes = {\n  classes: PropTypes.object.isRequired,\n}\n\nexport default withStyles(styles)(PrimeUlam)\n"]},"metadata":{},"sourceType":"module"}