{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Animation_1 = require(\"./Animation\");\n\nvar Global_1 = require(\"./Global\");\n\nexports.DD = {\n  startPointerPos: {\n    x: 0,\n    y: 0\n  },\n  anim: new Animation_1.Animation(function () {\n    var b = this.dirty;\n    this.dirty = false;\n    return b;\n  }),\n  isDragging: false,\n  justDragged: false,\n  offset: {\n    x: 0,\n    y: 0\n  },\n  node: null,\n  _drag: function _drag(evt) {\n    var node = exports.DD.node;\n\n    if (node) {\n      if (!exports.DD.isDragging) {\n        var pos = node.getStage().getPointerPosition();\n\n        if (!pos) {\n          node.getStage().setPointersPositions(evt);\n          pos = node.getStage().getPointerPosition();\n        }\n\n        var dragDistance = node.dragDistance();\n        var distance = Math.max(Math.abs(pos.x - exports.DD.startPointerPos.x), Math.abs(pos.y - exports.DD.startPointerPos.y));\n\n        if (distance < dragDistance) {\n          return;\n        }\n      }\n\n      node.getStage().setPointersPositions(evt);\n\n      if (!exports.DD.isDragging) {\n        exports.DD.isDragging = true;\n        node.fire('dragstart', {\n          type: 'dragstart',\n          target: node,\n          evt: evt\n        }, true);\n\n        if (!node.isDragging()) {\n          return;\n        }\n      }\n\n      node._setDragPosition(evt);\n\n      node.fire('dragmove', {\n        type: 'dragmove',\n        target: node,\n        evt: evt\n      }, true);\n    }\n  },\n  _endDragBefore: function _endDragBefore(evt) {\n    var node = exports.DD.node;\n\n    if (node) {\n      exports.DD.anim.stop();\n\n      if (exports.DD.isDragging) {\n        exports.DD.isDragging = false;\n        exports.DD.justDragged = true;\n        Global_1.Konva.listenClickTap = false;\n\n        if (evt) {\n          evt.dragEndNode = node;\n        }\n      }\n\n      exports.DD.node = null;\n      var drawNode = node.getLayer() || node instanceof Global_1.Konva['Stage'] && node;\n\n      if (drawNode) {\n        drawNode.draw();\n      }\n    }\n  },\n  _endDragAfter: function _endDragAfter(evt) {\n    evt = evt || {};\n    var dragEndNode = evt.dragEndNode;\n\n    if (evt && dragEndNode) {\n      dragEndNode.fire('dragend', {\n        type: 'dragend',\n        target: dragEndNode,\n        evt: evt\n      }, true);\n    }\n  }\n};\n\nif (Global_1.Konva.isBrowser) {\n  window.addEventListener('mouseup', exports.DD._endDragBefore, true);\n  window.addEventListener('touchend', exports.DD._endDragBefore, true);\n  window.addEventListener('mousemove', exports.DD._drag);\n  window.addEventListener('touchmove', exports.DD._drag);\n  window.addEventListener('mouseup', exports.DD._endDragAfter, false);\n  window.addEventListener('touchend', exports.DD._endDragAfter, false);\n}","map":{"version":3,"sources":["/home/daniel/reatret.net/react-app/node_modules/konva/lib/DragAndDrop.js"],"names":["Object","defineProperty","exports","value","Animation_1","require","Global_1","DD","startPointerPos","x","y","anim","Animation","b","dirty","isDragging","justDragged","offset","node","_drag","evt","pos","getStage","getPointerPosition","setPointersPositions","dragDistance","distance","Math","max","abs","fire","type","target","_setDragPosition","_endDragBefore","stop","Konva","listenClickTap","dragEndNode","drawNode","getLayer","draw","_endDragAfter","isBrowser","window","addEventListener"],"mappings":"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","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Animation_1 = require(\"./Animation\");\nvar Global_1 = require(\"./Global\");\nexports.DD = {\n    startPointerPos: {\n        x: 0,\n        y: 0\n    },\n    anim: new Animation_1.Animation(function () {\n        var b = this.dirty;\n        this.dirty = false;\n        return b;\n    }),\n    isDragging: false,\n    justDragged: false,\n    offset: {\n        x: 0,\n        y: 0\n    },\n    node: null,\n    _drag: function (evt) {\n        var node = exports.DD.node;\n        if (node) {\n            if (!exports.DD.isDragging) {\n                var pos = node.getStage().getPointerPosition();\n                if (!pos) {\n                    node.getStage().setPointersPositions(evt);\n                    pos = node.getStage().getPointerPosition();\n                }\n                var dragDistance = node.dragDistance();\n                var distance = Math.max(Math.abs(pos.x - exports.DD.startPointerPos.x), Math.abs(pos.y - exports.DD.startPointerPos.y));\n                if (distance < dragDistance) {\n                    return;\n                }\n            }\n            node.getStage().setPointersPositions(evt);\n            if (!exports.DD.isDragging) {\n                exports.DD.isDragging = true;\n                node.fire('dragstart', {\n                    type: 'dragstart',\n                    target: node,\n                    evt: evt\n                }, true);\n                if (!node.isDragging()) {\n                    return;\n                }\n            }\n            node._setDragPosition(evt);\n            node.fire('dragmove', {\n                type: 'dragmove',\n                target: node,\n                evt: evt\n            }, true);\n        }\n    },\n    _endDragBefore: function (evt) {\n        var node = exports.DD.node;\n        if (node) {\n            exports.DD.anim.stop();\n            if (exports.DD.isDragging) {\n                exports.DD.isDragging = false;\n                exports.DD.justDragged = true;\n                Global_1.Konva.listenClickTap = false;\n                if (evt) {\n                    evt.dragEndNode = node;\n                }\n            }\n            exports.DD.node = null;\n            var drawNode = node.getLayer() || (node instanceof Global_1.Konva['Stage'] && node);\n            if (drawNode) {\n                drawNode.draw();\n            }\n        }\n    },\n    _endDragAfter: function (evt) {\n        evt = evt || {};\n        var dragEndNode = evt.dragEndNode;\n        if (evt && dragEndNode) {\n            dragEndNode.fire('dragend', {\n                type: 'dragend',\n                target: dragEndNode,\n                evt: evt\n            }, true);\n        }\n    }\n};\nif (Global_1.Konva.isBrowser) {\n    window.addEventListener('mouseup', exports.DD._endDragBefore, true);\n    window.addEventListener('touchend', exports.DD._endDragBefore, true);\n    window.addEventListener('mousemove', exports.DD._drag);\n    window.addEventListener('touchmove', exports.DD._drag);\n    window.addEventListener('mouseup', exports.DD._endDragAfter, false);\n    window.addEventListener('touchend', exports.DD._endDragAfter, false);\n}\n"]},"metadata":{},"sourceType":"script"}